<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>CNSS Recruit 2024 Dev wp - Aununo&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Aununo&#039;s Blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Aununo&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="â€œDev å¯ä»¥æˆä¸ºä½ åˆ›é€ ä¸‡ç‰©çš„é€”å¾„ä¹‹ä¸€ï¼Œè¿™å°†ä¼´éšå·¨å¤§çš„æˆå°±æ„Ÿã€‚â€                        è¢«Guidelineå¸å¼•ï¼Œå‡èšç½‘ç»œå®‰å…¨å·¥ä½œå®¤2024å¹´ğŸ’»Devæ–¹å‘çš„æ‹›æ–°é¢˜ç›®ï¼Œè®°å½•ä¸€ä¸‹è‡ªå·±çš„wpã€‚"><meta property="og:type" content="blog"><meta property="og:title" content="CNSS Recruit 2024 Dev wp"><meta property="og:url" content="http://aununo.xyz/2024/09/30/CNSS%20Recruit%202024%20Dev%20wp/"><meta property="og:site_name" content="Aununo&#039;s Blog"><meta property="og:description" content="â€œDev å¯ä»¥æˆä¸ºä½ åˆ›é€ ä¸‡ç‰©çš„é€”å¾„ä¹‹ä¸€ï¼Œè¿™å°†ä¼´éšå·¨å¤§çš„æˆå°±æ„Ÿã€‚â€                        è¢«Guidelineå¸å¼•ï¼Œå‡èšç½‘ç»œå®‰å…¨å·¥ä½œå®¤2024å¹´ğŸ’»Devæ–¹å‘çš„æ‹›æ–°é¢˜ç›®ï¼Œè®°å½•ä¸€ä¸‹è‡ªå·±çš„wpã€‚"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://aununo.xyz/images/%E7%BC%A9%E7%95%A5%E5%9B%BE/guideline.png"><meta property="article:published_time" content="2024-09-30T14:09:09.000Z"><meta property="article:modified_time" content="2025-07-14T05:22:47.800Z"><meta property="article:author" content="Aununo Gan"><meta property="article:tag" content="Dev"><meta property="article:tag" content="CNSS"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://aununo.xyz/images/%E7%BC%A9%E7%95%A5%E5%9B%BE/guideline.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://aununo.xyz/2024/09/30/CNSS%20Recruit%202024%20Dev%20wp/"},"headline":"CNSS Recruit 2024 Dev wp","image":["http://aununo.xyz/images/%E7%BC%A9%E7%95%A5%E5%9B%BE/guideline.png"],"datePublished":"2024-09-30T14:09:09.000Z","dateModified":"2025-07-14T05:22:47.800Z","author":{"@type":"Person","name":"Aununo Gan"},"publisher":{"@type":"Organization","name":"Aununo's Blog","logo":{"@type":"ImageObject","url":"http://aununo.xyz/img/logo.svg"}},"description":"â€œDev å¯ä»¥æˆä¸ºä½ åˆ›é€ ä¸‡ç‰©çš„é€”å¾„ä¹‹ä¸€ï¼Œè¿™å°†ä¼´éšå·¨å¤§çš„æˆå°±æ„Ÿã€‚â€                        è¢«Guidelineå¸å¼•ï¼Œå‡èšç½‘ç»œå®‰å…¨å·¥ä½œå®¤2024å¹´ğŸ’»Devæ–¹å‘çš„æ‹›æ–°é¢˜ç›®ï¼Œè®°å½•ä¸€ä¸‹è‡ªå·±çš„wpã€‚"}</script><link rel="canonical" href="http://aununo.xyz/2024/09/30/CNSS%20Recruit%202024%20Dev%20wp/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Aununo&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://csdiy.wiki/"><i class="fa-solid fa-arrow-right"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal"><i class="fas fa-angle-double-right"></i>CNSS Recruit 2024 Dev wp</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="far fa-calendar-alt">Â </i><time dateTime="2024-09-30T14:09:09.000Z" title="2024-09-30T14:09:09.000Z">2024-09-30</time></span><span class="level-item is-hidden-mobile"><i class="far fa-calendar-check">Â </i><time dateTime="2025-07-14T05:22:47.800Z" title="2025-07-14T05:22:47.800Z">2025-07-14</time></span><span class="level-item"><i class="far fa-folder-open has-text-grey"></i>Â <a class="link-muted" href="/categories/DevOps/">DevOps</a></span><span class="level-item"><i class="far fa-clock"></i>Â  an hour read (About 12177 words)</span></div></div><div class="content"><p>â€œDev å¯ä»¥æˆä¸ºä½ åˆ›é€ ä¸‡ç‰©çš„é€”å¾„ä¹‹ä¸€ï¼Œè¿™å°†ä¼´éšå·¨å¤§çš„æˆå°±æ„Ÿã€‚â€</p>
<article class="message message-immersive is-info">
    <div class="message-body">
        <i class="fas fa-info-circle mr-2"></i>
        è¢«Guidelineå¸å¼•ï¼Œå‡èšç½‘ç»œå®‰å…¨å·¥ä½œå®¤2024å¹´ğŸ’»Devæ–¹å‘çš„æ‹›æ–°é¢˜ç›®ï¼Œè®°å½•ä¸€ä¸‹è‡ªå·±çš„wpã€‚
    </div>
</article>



<span id="more"></span>

<p><img src="/../images/%E7%BC%A9%E7%95%A5%E5%9B%BE/guideline.png" alt="guideline"></p>
<h2 id="ğŸ¥³MANï¼"><a href="#ğŸ¥³MANï¼" class="headerlink" title="ğŸ¥³MANï¼"></a>ğŸ¥³MANï¼</h2><p>ä½œä¸ºä¸€åDevæ‰‹ï¼Œå­¦ä¼šæŸ¥æ‰¾å¹¶æµè§ˆ<strong>å®˜æ–¹æ–‡æ¡£</strong>æ˜¯éå¸¸é‡è¦çš„èƒ½åŠ›ã€‚æœ¬é¢˜è¦æ±‚ä½ åˆæ­¥å­¦ä¼šä½¿ç”¨linuxç³»ç»Ÿè‡ªå¸¦çš„ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ–‡æ¡£ï¼š<code>man</code> ã€‚(å®é™…ä¸Šæ˜¯<strong>manual</strong>çš„è‹±æ–‡ç¼©å†™ï¼‰</p>
<ul>
<li>ä¹‹å‰æ²¡æœ‰ç”¨è¿‡linuxï¼Ÿæ²¡æœ‰å…³ç³»ï¼Œæ¥çœ‹ä¸€ä¸‹è¿™é—¨è¯¾ç¨‹å§ï¼š<a target="_blank" rel="noopener" href="https://missing-semester-cn.github.io/">https://missing-semester-cn.github.io/</a></li>
</ul>
<h3 id="CH1"><a href="#CH1" class="headerlink" title="CH1"></a>CH1</h3><p>é¦–å…ˆï¼Œä½ è¦åœ¨ç”µè„‘ä¸Šé…ç½®ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œè¿™é‡Œåˆ—å‡ºå‡ ä¸ªæ–¹æ¡ˆ:</p>
<ol>
<li>åœ¨windowsç¯å¢ƒä¸‹å¯ä»¥ä½¿ç”¨wslï¼ˆæ¯”è¾ƒæ¨èï¼‰</li>
<li>æˆ–è€…å¯ä»¥é…ç½®è™šæ‹Ÿæœº</li>
<li>æˆ–è€…æœ‰æ¡ä»¶å¯ä»¥æ‰¾ä¸€å°äº‘æœåŠ¡å™¨æˆ–è€…ä¹°å¦ä¸€å°å®ä½“æœºã€‚</li>
<li>åŒç³»ç»Ÿï¼ˆæ­¥éª¤æ¯”è¾ƒå¤æ‚ï¼‰</li>
</ol>
<p>å½“æˆ‘ä»¬æœ‰äº†linuxç¯å¢ƒåï¼Œä¸å¦¨åœ¨linuxç¯å¢ƒä¸‹ä½¿ç”¨gccç¼–è¯‘ä¸€ä¸ªè‡ªå·±å†™çš„â€Hello World!â€å¹¶è¿è¡Œï¼</p>
<h3 id="CH2"><a href="#CH2" class="headerlink" title="CH2"></a>CH2</h3><p>linuxæœ‰ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„æŒ‡ä»¤ï¼š<code>strace</code>ã€‚åŒæ—¶ï¼Œlinuxä¸­çš„<strong>æŒ‡ä»¤(command)<strong>ï¼Œ</strong>ç³»ç»Ÿè°ƒç”¨(system call)å’Œåº“å‡½æ•°(library function)</strong> åŸºæœ¬éƒ½å¯ä»¥ç”¨<code>man 1 [name]</code>, <code>man 2 [name]</code> <code>man 3 [name]</code>æ¥äº†è§£ä»–ä»¬çš„ç”¨æ³•ã€‚</p>
<p>å‡è®¾ä½ åœ¨CH1ä¸­çš„ç¨‹åºåä¸º<code>hello</code>ã€‚åœ¨åŒç›®å½•ä¸‹è¿è¡Œ<code>strace ./hello</code>ã€‚ç»“åˆä½ çœ‹åˆ°çš„<code>man</code>ä¸Šå¯¹<code>strace</code>çš„é˜è¿°ï¼Œç®€å•è§£é‡Šä¸‹è¿è¡Œç»“æœã€‚</p>
<hr>
<blockquote>
<p>In  the  simplest case strace runs the specified command until it exits.  It intercepts and records the <strong>system calls</strong> which are called by a process and the <strong>signals</strong> which are received by a process.  The name of each system call, its arguments and its return value are printed on standard error or to the file  specified with the -o option.</p>
</blockquote>
<p>è¾“å‡ºå±•ç¤ºäº†ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p>
<ul>
<li><code>execve</code>è°ƒç”¨hello_worldï¼Œä¼ é€’äº†PATHã€å‚æ•°å’Œ42ä¸ªç¯å¢ƒå˜é‡ï¼›è¿”å›0ï¼ŒæˆåŠŸæ‰§è¡Œã€‚</li>
<li><code>brk</code>æŸ¥è¯¢ç¨‹åºæ•°æ®æ®µæœ«å°¾ä½ç½®ï¼Œè¿”å›å€¼æ˜¯å½“å‰å†…å­˜åˆ†é…ä½ç½®ï¼Œç”¨äºç®¡ç†å†…å­˜ã€‚</li>
<li><code>mmap</code>ä¸ºç¨‹åºåˆ†é…ä¸€å—å†…å­˜ï¼Œè¿”å›åˆ†é…çš„å†…å­˜åœ°å€ï¼Œç”¨äºè¯»å†™æ“ä½œã€‚</li>
<li><code>access</code>åœ¨æ£€æŸ¥æ˜¯å¦å­˜åœ¨<code>ld.so.preload</code>æ–‡ä»¶ï¼Œè¿”å›é”™è¯¯ï¼Œæ²¡æœ‰æ‰¾åˆ°ã€‚</li>
<li><code>openat</code>æ‰“å¼€å…±äº«åº“ç¼“å­˜æ–‡ä»¶ï¼ŒæŸ¥æ‰¾ç¨‹åºä¾èµ–çš„å…±äº«åº“ï¼›å½“å‰ç¨‹åºä¾èµ–çš„libcåº“è¢«æ‰“å¼€ï¼Œç¨‹åºè¿”å›3ã€‚</li>
<li><code>read</code>ã€<code>mmap</code>å’Œ<code>close</code>è¡¨ç¤ºä»åº“ä¸­è¯»å–éœ€è¦çš„æ•°æ®ã€‚</li>
<li><code>arch_prctl</code>è®¾ç½®çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼Œä¸ºå¤šçº¿ç¨‹ç¯å¢ƒæä¾›æ”¯æŒã€‚ï¼ˆä¸æ‡‚ï¼‰</li>
<li><code>set_tid_address</code>å’Œ<code>set_robust_list</code>ç”¨äºçº¿ç¨‹çš„åˆå§‹åŒ–ã€è®¾ç½®çº¿ç¨‹çš„æ ‡è¯†åœ°å€ï¼Œé˜²æ­¢çº¿ç¨‹è¢«æ„å¤–ä¸­æ–­ã€‚ï¼ˆä¹Ÿä¸æ‡‚ï¼‰</li>
<li><code>mprotect</code>ä¿æŠ¤å†…å­˜é¡µé¢çš„æƒé™ï¼Œè®¾ç½®æŸäº›å†…å­˜åŒºåŸŸä¸ºåªè¯»ã€‚</li>
<li>ï¼ˆå¤§çš„è¦æ¥äº†ï¼‰<code>write(1, &quot;hello_world\n&quot;, 12) = 12</code>ï¼Œé€šè¿‡writeç³»ç»Ÿè°ƒç”¨å‘æ–‡ä»¶æè¿°ç¬¦1å³æ ‡å‡†è¾“å‡ºå†™å…¥12ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸²ã€‚</li>
<li><code>exit_group</code>é¡¾åæ€ä¹‰ï¼Œç»“æŸå¹¶æ­£å¸¸é€€å‡ºã€‚</li>
<li>+++ exited with 0 +++</li>
</ul>
<h3 id="CH3"><a href="#CH3" class="headerlink" title="CH3"></a>CH3</h3><p>è¿è¡Œ <code>man 3 exec</code>ã€‚ä½ èƒ½å†™ä¸€ä¸ªè¿ç”¨åˆ°äº†åº“å‡½æ•°<code>exec</code>çš„Cç¨‹åºå—ï¼Ÿ</p>
<hr>
<blockquote>
<p>The  exec() family of functions replaces the current process image with a new process image.</p>
</blockquote>
<p>å†™ç¨‹åºè°ƒç”¨execveæ¥æ›¿æ¢å½“å‰çš„è¿›ç¨‹ã€‚CH2çš„ç¬¬ä¸€ä¸ªè°ƒç”¨ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span>  <span class="comment">//execveæ‰€åœ¨çš„å¤´æ–‡ä»¶</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> **environ; <span class="comment">// å¼•ç”¨å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è¦æ‰§è¡Œçš„ç¨‹åºçš„è·¯å¾„</span></span><br><span class="line">    <span class="type">char</span> *program = <span class="string">&quot;/bin/ls&quot;</span>; </span><br><span class="line">    <span class="comment">// å‚æ•°</span></span><br><span class="line">    <span class="type">char</span> *args[] = &#123;<span class="string">&quot;ls&quot;</span>, <span class="literal">NULL</span>&#125;; </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰§è¡Œ execve ç³»ç»Ÿè°ƒç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (execve(program, args, environ) == <span class="number">-1</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;execve met problems.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);  <span class="comment">// ä½¿ç”¨ EXIT_FAILURE è¡¨ç¤ºå¤±è´¥é€€å‡º</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å’Œè¿è¡Œè¿™ä¸ªç¨‹åºã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -o execve_exp execve_exp.c</span><br><span class="line">$ ./execve_exp</span><br><span class="line">execve_exp  execve_exp.c  hello_world  test.c</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">execve_exp  execve_exp.c  hello_world  test.c</span><br></pre></td></tr></table></figure>





<h2 id="ğŸ˜¶â€ğŸŒ«ï¸Oop-Loop"><a href="#ğŸ˜¶â€ğŸŒ«ï¸Oop-Loop" class="headerlink" title="ğŸ˜¶â€ğŸŒ«ï¸Oop Loop"></a>ğŸ˜¶â€ğŸŒ«ï¸Oop Loop</h2><p>å­¦ä¹ cè¯­è¨€çš„æ•°ç»„éƒ¨åˆ†æ—¶ï¼Œæƒ³å‡ºäº†ä¸‰ç§éå†äºŒç»´æ•°ç»„çš„æ–¹æ³•ï¼Œå¹¶æƒ³åŠæ³•æµ‹é‡äº†è¿™ä¸‰ç§æ–¹æ³•æ‰€ä½¿ç”¨çš„æ—¶é—´ã€‚â€è¿™ä¸‰ç§æ–¹æ³•éƒ½è®¿é—®äº†<strong>åŒæ ·æ•°é‡</strong>çš„æ•°ç»„å…ƒç´ ï¼Œå› æ­¤ä»–ä»¬æ‰€è€—è´¹çš„æ—¶é—´ä¸€å®šæ˜¯å·®ä¸å¤šçš„ã€‚â€œä½†äº‹æƒ…è¿œæ²¡æœ‰è¿™ä¹ˆç®€å•ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UNIT_GAP 1000000.0</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">M_gettimeofday</span><span class="params">(<span class="keyword">struct</span> timeval *tv)</span> &#123;</span><br><span class="line">    <span class="type">int</span> result = gettimeofday(tv, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(result != <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;gettimeofday st\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ArrSize 15000</span></span><br><span class="line"><span class="type">int</span> arr1[ArrSize][ArrSize];</span><br><span class="line"><span class="type">int</span> arr2[ArrSize][ArrSize];</span><br><span class="line"><span class="type">int</span> arr3[ArrSize][ArrSize];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">/* Evaluate iterating pattern 1 */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv_st</span>;</span></span><br><span class="line">    M_gettimeofday(&amp;tv_st);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ArrSize; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; ArrSize; j++) &#123;</span><br><span class="line">            arr1[i][j] += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv_ed</span>;</span></span><br><span class="line">    M_gettimeofday(&amp;tv_ed);</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> time_gap1 = (<span class="type">double</span>) (tv_ed.tv_sec - tv_st.tv_sec) + ((<span class="type">double</span>) (tv_ed.tv_usec -  tv_st.tv_usec) / UNIT_GAP);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Evaluate iterating pattern 2 */</span></span><br><span class="line">    M_gettimeofday(&amp;tv_st);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ArrSize; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; ArrSize; j++) &#123;</span><br><span class="line">            arr2[j][i] += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    M_gettimeofday(&amp;tv_ed);</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> time_gap2 = (<span class="type">double</span>) (tv_ed.tv_sec - tv_st.tv_sec) + ((<span class="type">double</span>) (tv_ed.tv_usec -  tv_st.tv_usec) / UNIT_GAP);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Evaluate iterating pattern 3 */</span></span><br><span class="line">    M_gettimeofday(&amp;tv_st);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ArrSize; i++) &#123;</span><br><span class="line">        <span class="type">int</span> cap = (ArrSize / <span class="number">3</span>) * <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; cap; j+=<span class="number">3</span>) &#123;</span><br><span class="line">            arr3[i][j] += <span class="number">1</span>;</span><br><span class="line">            arr3[i][j + <span class="number">1</span>] += <span class="number">1</span>;</span><br><span class="line">            arr3[i][j + <span class="number">2</span>] += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = cap; j &lt; ArrSize; j++) &#123;</span><br><span class="line">            arr3[i][j] += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    M_gettimeofday(&amp;tv_ed);</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> time_gap3 = (<span class="type">double</span>) (tv_ed.tv_sec - tv_st.tv_sec) + ((<span class="type">double</span>) (tv_ed.tv_usec -  tv_st.tv_usec) / UNIT_GAP);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;time spent for time_gap1: %lf seconds\n&quot;</span>, time_gap1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;time spent for time_gap2: %lf seconds\n&quot;</span>, time_gap2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;time spent for time_gap3: %lf seconds\n&quot;</span>, time_gap3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>äº‹å®ä¸Šï¼Œè¿™ä¸‰ç§éå†æ–¹å¼ä½¿ç”¨çš„æ—¶é—´æœ‰æ˜æ˜¾çš„å·®åˆ«ã€‚</p>
<h3 id="CH1-1"><a href="#CH1-1" class="headerlink" title="CH1"></a>CH1</h3><p>å‘ç°æ¯æ¬¡ç¨‹åºçš„è¿è¡Œç»“æœå·®åˆ«éƒ½å¾ˆå¤§ï¼Œå› æ­¤éœ€è¦åå¤è¿è¡Œç¨‹åºå¾ˆå¤šæ¬¡æ‰èƒ½æ‰¾å‡ºä¸åŒéå†æ¨¡å¼ä¸‹çš„æ—¶é—´è§„å¾‹ã€‚è¯·ä½ å¸®ä»–ä¿®æ”¹ç¨‹åºï¼Œè®©ç¨‹åºçš„è¿è¡Œç»“æœéšæœºæ€§æ›´å°ï¼Œè¿™æ ·å°±èƒ½æ‰¾å‡ºæ›´åŠ å¯ä¿¡çš„ç»“è®ºäº†ï¼</p>
<hr>
<p>å®è·µå‡ºçœŸçŸ¥ï¼Œè·‘ä¸€ä¸‹çœ‹çœ‹ã€‚Oopsï¼Œæ„Ÿè§‰1å’Œ3çš„éšæœºæ€§å¾ˆå¼ºï¼Œ2å‡ ä¹æ˜¯æœ€æ…¢çš„ï¼Œä¸è¿‡ä¹Ÿæœ‰å°‘æ•°ä¾‹å¤–ã€‚ä¸ºäº†å‡å°‘éšæœºæ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¤šæ¬¡è·‘ä»£ç å–å¹³å‡å€¼ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UNIT_GAP 1000000.0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ArrSize 15000</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NUM_RUNS 5 <span class="comment">//è¿è¡Œ5æ¬¡å¹¶å–å¹³å‡å€¼</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">M_gettimeofday</span><span class="params">(<span class="keyword">struct</span> timeval *tv)</span> &#123;</span><br><span class="line">    <span class="type">int</span> result = gettimeofday(tv, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span>(result != <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;gettimeofday failed\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> arr1[ArrSize][ArrSize];</span><br><span class="line"><span class="type">int</span> arr2[ArrSize][ArrSize];</span><br><span class="line"><span class="type">int</span> arr3[ArrSize][ArrSize];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">double</span> total_time1 = <span class="number">0.0</span>, total_time2 = <span class="number">0.0</span>, total_time3 = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> run = <span class="number">0</span>; run &lt; NUM_RUNS; run++) &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv_st</span>, <span class="title">tv_ed</span>;</span></span><br><span class="line">        M_gettimeofday(&amp;tv_st);</span><br><span class="line">                 <span class="comment">/* PATTERN 1 */</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ArrSize; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; ArrSize; j++) &#123;</span><br><span class="line">                arr1[i][j] += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        M_gettimeofday(&amp;tv_ed);</span><br><span class="line">        <span class="type">double</span> time_gap1 = (<span class="type">double</span>) (tv_ed.tv_sec - tv_st.tv_sec) + </span><br><span class="line">                           ((<span class="type">double</span>) (tv_ed.tv_usec - tv_st.tv_usec) / UNIT_GAP);</span><br><span class="line">        total_time1 += time_gap1;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        M_gettimeofday(&amp;tv_st);</span><br><span class="line">                 <span class="comment">/* PATTERN 2 */</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ArrSize; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; ArrSize; j++) &#123;</span><br><span class="line">                arr2[j][i] += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        M_gettimeofday(&amp;tv_ed);</span><br><span class="line">        <span class="type">double</span> time_gap2 = (<span class="type">double</span>) (tv_ed.tv_sec - tv_st.tv_sec) + </span><br><span class="line">                           ((<span class="type">double</span>) (tv_ed.tv_usec - tv_st.tv_usec) / UNIT_GAP);</span><br><span class="line">        total_time2 += time_gap2;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        M_gettimeofday(&amp;tv_st);</span><br><span class="line">                 <span class="comment">/* PATTERN 3 */</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ArrSize; i++) &#123;</span><br><span class="line">            <span class="type">int</span> cap = (ArrSize / <span class="number">3</span>) * <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; cap; j += <span class="number">3</span>) &#123;</span><br><span class="line">                arr3[i][j] += <span class="number">1</span>;</span><br><span class="line">                arr3[i][j + <span class="number">1</span>] += <span class="number">1</span>;</span><br><span class="line">                arr3[i][j + <span class="number">2</span>] += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = cap; j &lt; ArrSize; j++) &#123;</span><br><span class="line">                arr3[i][j] += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        M_gettimeofday(&amp;tv_ed);</span><br><span class="line">        <span class="type">double</span> time_gap3 = (<span class="type">double</span>) (tv_ed.tv_sec - tv_st.tv_sec) + </span><br><span class="line">                           ((<span class="type">double</span>) (tv_ed.tv_usec - tv_st.tv_usec) / UNIT_GAP);</span><br><span class="line">        total_time3 += time_gap3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Average time spent for time_gap1: %lf seconds\n&quot;</span>, total_time1 / NUM_RUNS);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Average time spent for time_gap2: %lf seconds\n&quot;</span>, total_time2 / NUM_RUNS);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Average time spent for time_gap3: %lf seconds\n&quot;</span>, total_time3 / NUM_RUNS);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å—¯ï¼Œçœ‹èµ·æ¥æœ‰è§„å¾‹å¤šäº†ï¼š$2&gt;&gt;1&gt;3$ã€‚</p>
<h3 id="CH2-1"><a href="#CH2-1" class="headerlink" title="CH2"></a>CH2</h3><p>è¯•å›ç­”ä¸åŒéå†æ¨¡å¼ä¸‹è¿è¡Œæ—¶é—´çš„å·®åˆ«ï¼Œå¹¶è§£é‡Šä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™äº›å·®åˆ«ã€‚</p>
<hr>
<p>1æ˜¯è¡Œä¼˜å…ˆéå†ï¼Œè¿™ä¸Cä¸­<strong>è¡Œä¸»åº</strong>å­˜å‚¨æ•°ç»„çš„æ–¹å¼ä¸€è‡´ã€‚æ ¹æ®å±€éƒ¨æ€§ï¼ŒCPUå¯ä»¥æœ‰æ•ˆåœ°è¯»å–è¿ç»­çš„å†…å­˜å—ï¼Œå‡å°‘ç¼“å­˜æœªå‘½ä¸­æ¬¡æ•°ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚</p>
<p>è€Œ2æ˜¯åˆ—ä¼˜å…ˆéå†ï¼Œä¸1ç›¸åï¼Œè¿™ç§è®¿é—®æ¨¡å¼å¯¼è‡´å¤§é‡ç¼“å­˜æœªå‘½ä¸­ã€æ•ˆç‡ä½ã€‚</p>
<blockquote>
<p>å…³äºåŸç†è§£é‡Šé‚£ä¸€éƒ¨åˆ†ï¼Œåªé cpuç¼“å­˜å…¶å®ä¸å¤ªèƒ½è§£é‡Š ç¬¬ä¸‰ä¸ªpattern è€—æ—¶æ¯”ç¬¬ä¸€ä¸ªpatternå°çš„é—®é¢˜qwqâ€”â€”Shiver</p>
</blockquote>
<p>3åˆ™ä½¿ç”¨äº†<strong>å¾ªç¯å±•å¼€</strong>ä¼˜åŒ–ã€‚æ¯æ¬¡å¤„ç†ä¸‰ä¸ªå…ƒç´ ï¼Œå‡å°‘äº†æ¯æ¬¡æ›´æ–°è¿­ä»£çš„æ§åˆ¶å¼€é”€ï¼Œåœ¨å¤§è§„æ¨¡è¿›è¡Œæ•°ç»„éå†æ—¶ï¼Œä¼šç´¯ç§¯æˆæ˜æ˜¾çš„æ€§èƒ½æå‡ã€‚</p>
<p>å¦å¤–ç”±äºæ•°ç»„å…ƒç´ æ˜¯æ¯ä¸‰ä¸ªè®¿é—®çš„ï¼Œæ›´å®¹æ˜“é¢„å–æ›´å¤šæ•°æ®åˆ°<strong>ç¼“å­˜</strong>ä¸­ï¼Œè¿›ä¸€æ­¥å‡å°‘äº†ç¼“å­˜æœªå‘½ä¸­çš„æŸå¤±ã€‚</p>
<p><strong>æµæ°´çº¿</strong>ä¼˜åŒ–ï¼šç°ä»£å¤„ç†å™¨ä½¿ç”¨æµæ°´çº¿æŠ€æœ¯æ¥æé«˜æŒ‡ä»¤æ‰§è¡Œçš„æ•ˆç‡ã€‚3é€šè¿‡å‡å°‘å¾ªç¯æ¬¡æ•°å’Œå¢åŠ æ¯æ¬¡å¾ªç¯å†…å¤„ç†çš„æ•°æ®é‡ï¼Œå‡å°‘äº†å…¶å®ƒåˆ†æ”¯æŒ‡ä»¤ï¼Œä½¿å¤„ç†å™¨æµæ°´çº¿æ›´é¡ºç•…ã€‚è¿™å¯ä»¥å‡å°‘æµæ°´çº¿åœé¡¿ï¼Œä»è€Œæé«˜æ•´ä½“æ‰§è¡Œé€Ÿåº¦ã€‚</p>
<p><strong>åˆ†æ”¯é¢„æµ‹</strong>ï¼šå¾ªç¯çš„æ£€æŸ¥æ¡ä»¶å˜å°‘äº†ï¼Œåˆ†æ”¯é¢„æµ‹é”™è¯¯çš„æ¦‚ç‡ä¹Ÿé™ä½äº†ã€‚</p>
<p>å¯èƒ½å­˜åœ¨çš„<strong>å‘é‡åŒ–</strong>ä¼˜åŒ–ï¼Ÿç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨å°†è¿™ç§æ¯æ¬¡æ“ä½œå¤šä¸ªç›¸é‚»å…ƒç´ è½¬æ¢ä¸ºSIMDæŒ‡ä»¤ã€‚è¿™æ„å‘³ç€å¤„ç†å™¨å¯ä»¥åœ¨ä¸€ä¸ªæŒ‡ä»¤å‘¨æœŸå†…å¯¹å¤šä¸ªæ•°æ®è¿›è¡Œç›¸åŒçš„æ“ä½œï¼Œæå‡è¿ç®—é€Ÿåº¦ã€‚</p>
<p>è¿ç»­è®¿é—®å¤šä¸ªå…ƒç´ æ›´æœ‰å¯èƒ½ä¿æŒå†…å­˜å¯¹é½ï¼Œä»è€Œå‡å°‘é¢å¤–çš„å†…å­˜æ“ä½œå¼€é”€ã€‚</p>
<p>ç”±äºå¾ªç¯ä½“å†…æ“ä½œç›¸äº’ç‹¬ç«‹ï¼Œå¤„ç†å™¨å¯ä»¥å¹¶è¡Œå¤„ç†å¤šä¸ªæ“ä½œï¼Œè¿›ä¸€æ­¥æå‡é€Ÿåº¦ã€‚</p>
<h2 id="â™¿é€ è½®å­"><a href="#â™¿é€ è½®å­" class="headerlink" title="â™¿é€ è½®å­"></a>â™¿é€ è½®å­</h2><blockquote>
<p>Git æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç”¨äºè·Ÿè¸ªä»£ç æˆ–æ–‡ä»¶çš„æ›´æ”¹ï¼Œå¹¶æ”¯æŒå¤šäººåä½œå¼€å‘ã€‚</p>
<p>ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°gitçš„æºä»£ç : <a target="_blank" rel="noopener" href="https://github.com/git/git">https://github.com/git/git</a></p>
</blockquote>
<p>Shiveræƒ³è¦åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šå®‰è£…<code>git</code>ã€‚</p>
<p>ä»¥å‰ï¼Œä»–æ˜¯é€šè¿‡ç³»ç»Ÿçš„è½¯ä»¶åŒ…ç®¡ç†å™¨æ¥å®‰è£…<code>git</code>çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨ubuntuç³»ç»Ÿä¸­å°±å¯ä»¥ä½¿ç”¨è¿™ä¸¤è¡Œå‘½ä»¤æ¥å®‰è£…gitï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> apt update</span><br><span class="line">$ <span class="built_in">sudo</span> apt install git</span><br></pre></td></tr></table></figure>

<p>ä½†ä»Šå¤©ï¼Œå®ƒæƒ³æ¢ç‚¹æ–°èŠ±æ ·ã€‚ä»–æƒ³è¦é€šè¿‡æºä»£ç æ¥ç¼–è¯‘<code>git</code>ï¼</p>
<blockquote>
<p>gitçš„æºä»£ç å¾ˆå¤šåœ°æ–¹éƒ½æœ‰ï¼Œè¿™é‡Œæ¯”è¾ƒæ¨èä½¿ç”¨githubä¸Šçš„ä»£ç ä»“åº“ï¼Œå¹¶é€šè¿‡git cloneä¸‹è½½ã€‚ï¼ˆä¸è¦åæ§½ä¸ºä»€ä¹ˆç”µè„‘ä¸Šå·²ç»æœ‰gitäº†ä¸ºä¸ºä»€ä¹ˆè¿˜è¦ä¸‹è½½gitæºç ï¼‰</p>
</blockquote>
<p>åŒæ—¶ï¼Œ<code>Shiver</code>è¿˜é€šè¿‡ä¿®æ”¹æºä»£ç å®ç°äº†ä¿®æ”¹gitè°ƒç”¨ç‰ˆæœ¬ä¿¡æ¯åçš„è¾“å‡ºã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼ŒShiveræƒ³è¦ä½ å®ç°å¦‚ä¸‹çš„æ“ä½œï¼š</p>
<ol>
<li>åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šç¼–è¯‘ <code>git</code> ç¨‹åºï¼Œå¹¶åœ¨æäº¤æ–‡æ¡£ä¸­ç®€å•é˜è¿°è‡ªå·±åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ä¸è‡ªå·±æ˜¯æ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜çš„ã€‚</li>
<li>ä¿®æ”¹ <code>git</code> çš„æºä»£ç ï¼Œä½¿å…¶åœ¨è¾“å‡ºç‰ˆæœ¬ä¿¡æ¯æ—¶ä¼šæœ‰é¢å¤–çš„ <code>&lt;-- CNSS --&gt;</code> æç¤ºï¼ˆä½ ä¹Ÿå¯ä»¥æ·»åŠ è‡ªå·±å–œæ¬¢çš„ä¿¡æ¯ï¼‰å¹¶æˆªå›¾æäº¤ã€‚ï¼ˆè¿™å¯èƒ½éœ€è¦ä½ å…·æœ‰ä¸€å®šçš„ä»£ç é˜…è¯»èƒ½åŠ›ï¼‰</li>
</ol>
<p>Hintsï¼š</p>
<ul>
<li>æ€ä¹ˆç¼–è¯‘ï¼Ÿè¦ä¸å…ˆä»æ–‡æ¡£å¼€å§‹ï¼Œæ¯”å¦‚æºä»£ç ä¸­çš„<code>README.md</code>ï¼Œ<code>INSTALL</code>æ–‡ä»¶ï¼Ÿ</li>
<li>ä»€ä¹ˆæ˜¯cmakeï¼Ÿ</li>
</ul>
<hr>
<p>Aï¼‰ç¼–è¯‘éœ€è¦ä¾èµ–ï¼Œåœ¨GPTçš„å¸®åŠ©ä¸‹æ€’è£…ä¾èµ–é¡¹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install -y make libssl-dev libcurl4-gnutls-dev libexpat1-dev gettext</span><br></pre></td></tr></table></figure>

<p>Bï¼‰è·å–Gitçš„æºç å¹¶ç¼–è¯‘Gitç¨‹åºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:git/git.git</span><br><span class="line">make configure</span><br><span class="line">./configure --prefix=/usr/local <span class="comment">#æŒ‡å®šå®‰è£…è·¯å¾„ï¼Œé˜²æ­¢å†²çª</span></span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<p>Cï¼‰é‡åˆ°æŠ¥é”™ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ld: libgit.a(utf8.o): <span class="keyword">in</span> <span class="keyword">function</span> `reencode_string_iconv<span class="string">&#x27;:</span></span><br><span class="line"><span class="string">/home/aununo/CNSS/git/utf8.c:498:(.text+0x10dd): undefined reference to `libiconv&#x27;</span></span><br><span class="line">/usr/bin/ld: libgit.a(utf8.o): <span class="keyword">in</span> <span class="keyword">function</span> `reencode_string_len<span class="string">&#x27;:</span></span><br><span class="line"><span class="string">/home/aununo/CNSS/git/utf8.c:593:(.text+0x121d): undefined reference to `libiconv_open&#x27;</span></span><br><span class="line">/usr/bin/ld: /home/aununo/CNSS/git/utf8.c:603:(.text+0x1252): undefined reference to `libiconv_close<span class="string">&#x27;</span></span><br><span class="line"><span class="string">/usr/bin/ld: /home/aununo/CNSS/git/utf8.c:593:(.text+0x129e): undefined reference to `libiconv_open&#x27;</span></span><br><span class="line">/usr/bin/ld: /home/aununo/CNSS/git/utf8.c:603:(.text+0x12c9): undefined reference to `libiconv_close<span class="string">&#x27;</span></span><br><span class="line"><span class="string">/usr/bin/ld: /home/aununo/CNSS/git/utf8.c:598:(.text+0x136b): undefined reference to `libiconv_open&#x27;</span></span><br><span class="line">collect2: error: ld returned 1 <span class="built_in">exit</span> status</span><br><span class="line">make: *** [Makefile:2842: git-daemon] Error 1</span><br></pre></td></tr></table></figure>

<p>å¤§æ¦‚æ˜¯è¯´ç¼ºå°‘ <code>libiconv</code> åº“çš„å¼•ç”¨ã€‚<code>libiconv</code> æ˜¯ä¸€ä¸ªç”¨äºå­—ç¬¦ç¼–ç è½¬æ¢çš„åº“ï¼Œè€Œ Git åœ¨å¤„ç†å­—ç¬¦é›†è½¬æ¢æ—¶ä¾èµ–äºå®ƒã€‚æˆ‘ä»¬ä½¿ç”¨å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ldconfig -p | grep libiconv <span class="comment">#æ£€æŸ¥libiconvæ˜¯å¦æˆåŠŸå®‰è£…</span></span><br><span class="line">        libiconv_hook.so.1 (libc6,x86-64) =&gt; /lib/x86_64-linux-gnu/libiconv_hook.so.1</span><br><span class="line">        libiconv_hook.so (libc6,x86-64) =&gt; /lib/x86_64-linux-gnu/libiconv_hook.so</span><br></pre></td></tr></table></figure>

<p>ç³»ç»Ÿä¸Šæœ‰ <code>libiconv_hook.so</code>ï¼Œè€Œä¸æ˜¯æ ‡å‡†çš„ <code>libiconv.so</code>ã€‚ç”±äº <code>libiconv_hook</code> å¹¶æ²¡æœ‰æä¾› <code>libiconv.so</code> çš„æ ‡å‡†æ¥å£ï¼Œå¯¼è‡´äº†ç¼–è¯‘å’Œæµ‹è¯•æ—¶å‡ºç°é”™è¯¯ã€‚åˆ›å»ºç¬¦å·é“¾æ¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -s /lib/x86_64-linux-gnu/libiconv_hook.so.1 /lib/x86_64-linux-gnu/libiconv.so.2</span><br></pre></td></tr></table></figure>

<p>è®©ç³»ç»Ÿä¸­çš„ <code>libiconv_hook.so</code> æ¨¡æ‹Ÿ <code>libiconv.so.2</code>ï¼ŒéªŒè¯ä¸€ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ldconfig -p | grep libiconv</span><br><span class="line">        libiconv_hook.so.1 (libc6,x86-64) =&gt; /lib/x86_64-linux-gnu/libiconv_hook.so.1</span><br><span class="line">        libiconv_hook.so (libc6,x86-64) =&gt; /lib/x86_64-linux-gnu/libiconv_hook.so</span><br><span class="line">        libiconv.so.2 (libc6,x86-64) =&gt; /usr/local/lib/libiconv.so.2</span><br><span class="line">        libiconv.so (libc6,x86-64) =&gt; /usr/local/lib/libiconv.so</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿›è¡Œmakeç¼–è¯‘æˆåŠŸï¼å†å¤ç°ä¸€éã€‚</p>
<ul>
<li><p>ä½¿ç”¨çš„ç‰ˆæœ¬åŸºäº <code>2.46.2</code>ï¼Œå¹¶ä¸”åœ¨æ­¤ç‰ˆæœ¬å‘å¸ƒåæœ‰ 628 æ¬¡æäº¤ã€‚</p>
</li>
<li><p>å½“å‰ç‰ˆæœ¬å¯¹åº”çš„å…·ä½“æäº¤å“ˆå¸Œæ˜¯ <code>6258f68c3c</code>ã€‚ï¼ˆå¤ç°å‰åé¢è¿˜æœ‰ä¸ª<code>.dirty</code>è¡¨ç¤ºåœ¨å·¥ä½œç›®å½•ä¸­æœ‰æœªæäº¤çš„æ›´æ”¹ï¼‰</p>
</li>
</ul>
<p>Git çš„ç‰ˆæœ¬ä¿¡æ¯ç”± <code>git --version</code> å‘½ä»¤ç”Ÿæˆï¼Œè¾“å‡ºgit versionï¼Œä¸‹é¢æˆ‘ä»¬è¿›è¡ŒæŸ¥æ‰¾ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -r <span class="string">&quot;git version&quot;</span> .</span><br></pre></td></tr></table></figure>

<p>æŠŠå¤§é‡è¾“å‡ºå–‚ç»™GPTå‘ç°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./help.c:        * with external projects that rely on the output of <span class="string">&quot;git version&quot;</span>.</span><br><span class="line">./help.c:       strbuf_addf(buf, <span class="string">&quot;git version %s\n&quot;</span>, git_version_string);</span><br><span class="line">./help.c:               N_(<span class="string">&quot;git version [--build-options]&quot;</span>),</span><br></pre></td></tr></table></figure>

<p>Here it is! åœ¨vscodeä¸­æŸ¥æ‰¾å¹¶ç¼–è¾‘help.cæ–‡ä»¶ï¼Œä¿®æ”¹è¾“å‡ºå³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strbuf_addf(buf, <span class="string">&quot;git version %s\n&quot;</span>, git_version_string);</span><br><span class="line">=&gt;   strbuf_addf(buf, <span class="string">&quot;&lt;-- CNSS --&gt; git version %s I l0v3 Sh1v3r~\n&quot;</span>, git_version_string);</span><br></pre></td></tr></table></figure>

<p>é‡æ–°makeä¸€ä¸‹ï¼Œè¾“å‡ºæ—¶å‘ç°åé¢å¤šäº†ä¸€ä¸ªdirtyã€‚æ˜¯ä¿®æ”¹äº†help.cå´æ²¡æäº¤æ›´æ”¹çš„ç¼˜æ•…ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°è¾“å‡º<code>&lt;-- CNSS --&gt; git version 2.46.2.628.g6258f68c3c.dirty I l0v3 Sh1v3r~</code></p>
<h2 id="âš’ï¸Dig-and-Dig"><a href="#âš’ï¸Dig-and-Dig" class="headerlink" title="âš’ï¸Dig and Dig"></a>âš’ï¸Dig and Dig</h2><blockquote>
<p>ssgæ˜¯ä¸€åèµ„æ·±çš„Minecraftç©å®¶ï¼Œå¹³æ—¶æœ€å–œæ¬¢çš„å°±æ˜¯åœ¨MCçš„è¾½é˜”åœŸåœ°ä¸Šå¯»æ‰¾çè´µçš„çŸ¿çŸ³ã€‚</p>
</blockquote>
<h3 id="CH1-2"><a href="#CH1-2" class="headerlink" title="CH1"></a>CH1</h3><p>ä»åŸç‰ˆåˆ°æ•´åˆåŒ…ï¼Œä»æˆ‘çš„ä¸–ç•Œåˆ°æ³°æ‹‰ç‘äºšï¼ŒssgæŒ–çŸ¿çš„è¶³è¿¹åˆ†å¸ƒåœ¨å„ä¸ªé¢†åŸŸã€‚</p>
<p>æœ‰ä¸€å¤©ï¼Œä»–çªç„¶å¥½å¥‡æƒ³æŒ–æŒ–çœ‹ Cè¯­è¨€ç¨‹åºï¼Œäºæ˜¯ä»–å†™ä¸‹äº†è¿™æ®µä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> depth;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Dig</span> <span class="params">(<span class="type">int</span> digging)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (digging &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> where_are_we;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;In depth %d, we are at %p \n&quot;</span>, (depth - digging), (<span class="type">void</span> *) &amp;where_are_we);</span><br><span class="line"></span><br><span class="line">    Dig(digging - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Today we will dig: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;depth);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Let begin!\n&quot;</span>);</span><br><span class="line">    Dig(depth);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»–å†³å®šå…ˆå‘ä¸‹é¢æŒ–æ˜ 10 ä¸ªå‡½æ•°çš„æ·±åº¦ï¼Œäºæ˜¯ä»–å°†<code>depth</code> å˜é‡è®¾ç½®ä¸ºäº† 10 å¹¶å¾—åˆ°äº†è¿™æ ·çš„ç»“æœï¼š</p>
<blockquote>
<p>Today we will dig: 10<br>Let begin!<br>In depth 0, we are at 0x7fffbc3fea14<br>In depth 1, we are at 0x7fffbc3fe9e4<br>In depth 2, we are at 0x7fffbc3fe9b4<br>In depth 3, we are at 0x7fffbc3fe984<br>In depth 4, we are at 0x7fffbc3fe954<br>In depth 5, we are at 0x7fffbc3fe924<br>In depth 6, we are at 0x7fffbc3fe8f4<br>In depth 7, we are at 0x7fffbc3fe8c4<br>In depth 8, we are at 0x7fffbc3fe894<br>In depth 9, we are at 0x7fffbc3fe864<br>In depth 10, we are at 0x7fffbc3fe834</p>
</blockquote>
<p>çœ‹èµ·æ¥ä¸é”™ï¼Œäºæ˜¯ä»–å†³å®šç»§ç»­å‘ä¸‹æŒ–ï¼Œä½†ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œå½“ <code>depth</code> è¶³å¤Ÿå¤§æ—¶ï¼Œç¨‹åºå°±ç»ˆæ­¢è¿ä½œäº†ï¼</p>
<p>å› æ­¤ ssg æ‰¾åˆ°ä½ ï¼Œæƒ³è¯·ä½ å¸®ä»–è§£å†³è¿™äº›é—®é¢˜ï¼š</p>
<ol>
<li>å°è¯•ä¿®æ”¹ç¨‹åºï¼Œä½¿ssgçš„è¿™ä¸ªç¨‹åºèƒ½ç»Ÿè®¡ä»– <strong>æ€»å…±</strong> èƒ½å¤Ÿå‘ä¸‹æŒ–æ˜å¤šå°‘ä¸ª Byteã€‚å¤šæ¬¡è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œæ¯æ¬¡èƒ½å‘ä¸‹æŒ–çš„Byteæ˜¯å›ºå®šçš„å—ï¼Ÿ</li>
</ol>
<p>è¿è¡Œåˆå§‹ç¨‹åºçœ‹çœ‹depthçš„æœ€å¤§å€¼ï¼Œå‘ç°æ¯æ¬¡è¿è¡Œå¾—åˆ°çš„æœ€å¤§æ·±åº¦ç›¸è¿‘ä½†ä¸åŒã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ ./dig</span><br><span class="line">Today we will dig: 1000000</span><br><span class="line">Let begin!</span><br><span class="line">...</span><br><span class="line">In depth 174513, we are at 0x7ffcccda07a4</span><br><span class="line">[1]    2146 segmentation fault  ./dig</span><br><span class="line"><span class="comment"># ----------------------------------- #</span></span><br><span class="line">In depth 174450, we are at 0x7ffda0d677a4</span><br><span class="line">[1]    2165 segmentation fault  ./dig</span><br><span class="line"><span class="comment"># ----------------------------------- #</span></span><br><span class="line">In depth 174576, we are at 0x7ffc72f5f7a4</span><br><span class="line">[1]    2688 segmentation fault  ./dig</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œç¨‹åºåœ¨<code>174513</code>å¤„å´©æºƒï¼Œè€Œç¬¬äºŒæ¬¡è¿è¡Œåœ¨<code>174450</code>å¤„å´©æºƒï¼Œæ“ä½œç³»ç»Ÿä¸ºè¿›ç¨‹åˆ†é…çš„æ ˆç©ºé—´æ¯æ¬¡å¯èƒ½ä¼šç•¥æœ‰ä¸åŒï¼Œå› æ­¤è¿™äº›æ·±åº¦å€¼å¹¶ä¸å®Œå…¨ä¸€è‡´ã€‚segmentation faultçš„æ®µé”™è¯¯å‘ç”Ÿåœ¨ç¨‹åºè¯•å›¾è®¿é—®æœªè¢«å…è®¸è®¿é—®çš„å†…å­˜åŒºåŸŸæ—¶ã€‚</p>
<blockquote>
<p>[1] æ˜¯Linuxç³»ç»Ÿä¸ºæ¯ä¸ªåå°ä»»åŠ¡åˆ†é…çš„ä½œä¸šå·ï¼Œ1è¡¨ç¤ºè¿™æ˜¯å½“å‰ä¼šè¯çš„ç¬¬ä¸€ä¸ªåå°è¿›ç¨‹ã€‚</p>
<p>2146å’Œ2165æ˜¯è¿›ç¨‹IDï¼Œæ˜¯ç³»ç»Ÿä¸ºæ¯ä¸ªè¿è¡Œç¨‹åºåˆ†é…çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</p>
</blockquote>
<p>è®°å½•ä¸€ä¸‹åˆå§‹åœ°å€ï¼Œç”¨where_are_weå‡åˆå§‹åœ°å€å¾—åˆ°æ‰€åœ¨æ·±åº¦ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> depth;</span><br><span class="line"><span class="type">void</span> *initial_address = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Dig</span> <span class="params">(<span class="type">int</span> digging)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (digging &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> where_are_we;</span><br><span class="line">    <span class="keyword">if</span> (initial_address == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        initial_address = &amp;where_are_we;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> current_depth_bytes = <span class="built_in">abs</span>((<span class="type">char</span> *) initial_address - (<span class="type">char</span> *) &amp;where_are_we);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;In depth %d, we are at %p, depth in bytes: %d \n&quot;</span>, (depth - digging), (<span class="type">void</span> *) &amp;where_are_we, current_depth_bytes);</span><br><span class="line"></span><br><span class="line">    Dig(digging - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Today we will dig: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;depth);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Let begin!\n&quot;</span>);</span><br><span class="line">    Dig(depth);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œä¸€ä¸‹ç¨‹åºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ./dig</span><br><span class="line">Today we will dig: 100</span><br><span class="line">Let begin!</span><br><span class="line">In depth 0, we are at 0x7ffdd7afae10, depth <span class="keyword">in</span> bytes: 0</span><br><span class="line">In depth 1, we are at 0x7ffdd7afade0, depth <span class="keyword">in</span> bytes: 48</span><br><span class="line">...</span><br><span class="line">In depth 100, we are at 0x7ffdd7af9b50, depth <span class="keyword">in</span> bytes: 4800</span><br></pre></td></tr></table></figure>

<p>å‘ç°æ¯æ¬¡èƒ½å‘ä¸‹æŒ–çš„å­—èŠ‚æ•°æ˜¯å›ºå®šçš„48å­—èŠ‚ã€‚</p>
<ol start="2">
<li>å°è¯•è§£é‡Šä¸ºä»€ä¹ˆ<code>depth</code>è¶³å¤Ÿå¤§æ—¶ç¨‹åºä¼šåœæ­¢è¿è¡Œã€‚</li>
</ol>
<p>é€’å½’æ·±åº¦è¿‡æ·±ï¼Œå‘ç”Ÿäº†æ ˆæº¢å‡ºã€‚å‡½æ•°çš„é€’å½’è°ƒç”¨ä¼šåœ¨æ ˆä¸Šåˆ†é…å†…å­˜ï¼Œè€Œæ ˆçš„å¤§å°æ˜¯æœ‰é™çš„ã€‚å½“é€’å½’æ·±åº¦è¶…å‡ºç³»ç»Ÿåˆ†é…ç»™ç¨‹åºçš„æ ˆå†…å­˜æ—¶ï¼Œç¨‹åºå°±ä¼šå‘ç”Ÿæ ˆæº¢å‡ºï¼Œä»è€Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p>
<ol start="3">
<li>å°è¯•è§£é‡Šä¸ºä»€ä¹ˆæ¯æ¬¡å±‚æ•°çš„é—´éš”éƒ½ä¸º 48Byte, è¿™48Byteé‡Œé¢éƒ½åŒ…å«äº†äº›ä»€ä¹ˆï¼Ÿ</li>
</ol>
<p>å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­çš„æ ˆå¸§ç»“æ„ï¼Œè¯´æ˜è¿™ä¸ªå‡½æ•°ä¸­ä¸€ä¸ªæ ˆå¸§å¤§å°ä¸º48byteã€‚åŒ…å«ï¼šå‡½æ•°çš„è¿”å›åœ°å€ï¼Œå±€éƒ¨å˜é‡ï¼Œå‡½æ•°å‚æ•°ç­‰ã€‚</p>
<p>æ¯”å¦‚å°†å‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡where_are_weç±»å‹æ”¹ä¸ºlongæ—¶ï¼Œå±‚æ•°é—´éš”ä¼šå˜ä¸º64byteã€‚</p>
<h3 id="CH2-2"><a href="#CH2-2" class="headerlink" title="CH2"></a>CH2</h3><p>ssgåœ¨æŒ–çŸ¿çš„æ—¶å€™æ˜¯å·¦å³æ‰‹äº¤æ›¿è¿›è¡Œçš„ï¼Œå› æ­¤ä»–æƒ³è®°å½•ä¸‹è‡ªå·±åœ¨æŒ–æ˜æ¯ä¸€å±‚æ—¶ä½¿ç”¨çš„æ˜¯å·¦æ‰‹è¿˜æ˜¯å³æ‰‹ï¼Œäºæ˜¯ä»–å†™ä¸‹äº†è¿™æ®µä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> depth;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span>* <span class="title function_">WhichHand</span><span class="params">(<span class="type">bool</span> hand)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> hand ? <span class="string">&quot;left hand&quot;</span> : <span class="string">&quot;right hand&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">Dig1</span> <span class="params">(<span class="type">int</span> digging)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>( digging &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> now_hand = !Dig1(digging - <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;In depth %d, we use %s \n&quot;</span>, (depth - digging), WhichHand(now_hand));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> now_hand;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">Dig2</span> <span class="params">(<span class="type">int</span> digging, <span class="type">bool</span> hand)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>( digging &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> hand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;In depth %d, we use %s \n&quot;</span>, (depth - digging), WhichHand(hand));</span><br><span class="line">    <span class="keyword">return</span> Dig2(digging - <span class="number">1</span>, !hand);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Today we will dig: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;depth);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Let begin!\n&quot;</span>);</span><br><span class="line">    Dig1(depth);</span><br><span class="line">    <span class="comment">//Dig2(depth, 0);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Dig1</code>å’Œ<code>Dig2</code>æ˜¯ä»–ç¼–å†™çš„ä¸¤ä¸ªä¸åŒç‰ˆæœ¬ä½†æ˜¯æ•ˆæœç›¸ä¼¼çš„å‡½æ•°ï¼Œçœ‹èµ·æ¥è¿è¡Œçš„ä¸é”™ï¼š</p>
<blockquote>
<p>Today we will dig: 10<br>Let begin!<br>In depth 10, we use left hand<br>In depth 9, we use right hand<br>In depth 8, we use left hand<br>In depth 7, we use right hand<br>In depth 6, we use left hand<br>In depth 5, we use right hand<br>In depth 4, we use left hand<br>In depth 3, we use right hand<br>In depth 2, we use left hand<br>In depth 1, we use right hand<br>In depth 0, we use left hand</p>
</blockquote>
<p>ä½†ssgå‘ç°äº†ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œå½“ä»–ä½¿ç”¨ <strong>O2 ä¼˜åŒ–</strong>(å³åœ¨gccç¼–è¯‘æ—¶æ·»åŠ <code>-O2</code>æŒ‡ä»¤)åˆ†åˆ«ç¼–è¯‘è¿è¡Œäº†ä¸¤ä¸ªä¸åŒç‰ˆæœ¬çš„å‡½æ•°åï¼Œæœ‰ä¸€ä¸ªç‰ˆæœ¬çš„å‡½æ•°ï¼Œæ— è®ºä»–å°†æ·±åº¦è®¾ç½®ä¸ºå¤šå¤§ï¼Œéƒ½å¯ä»¥æ­£å¸¸è¿è¡Œï¼</p>
<p>ä»–ç°åœ¨æƒ³è€ƒè€ƒä½ :</p>
<ol>
<li>å“ªä¸ªç‰ˆæœ¬çš„å‡½æ•°æ— è®ºè®¾ç½®å¤šå¤§çš„æ·±åº¦éƒ½å¯ä»¥æ­£å¸¸è¿è¡Œï¼Ÿ</li>
</ol>
<p><code>dig2</code>å‡½æ•°ã€‚æˆ‘ä»¬æ¥è·‘ä¸€ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -O2 -o dig1 dig1.c <span class="comment">#O2ä¼˜åŒ–å¯ç”¨äº†åŒ…æ‹¬-Wunused-resultåœ¨å†…çš„è­¦å‘Šï¼Œæ£€æŸ¥scanfè¿”å›å€¼</span></span><br><span class="line">dig1.c: In <span class="keyword">function</span> â€˜mainâ€™:</span><br><span class="line">dig1.c:34:5: warning: ignoring <span class="built_in">return</span> value of â€˜scanfâ€™ declared with attribute â€˜warn_unused_resultâ€™ [-Wunused-result]</span><br><span class="line">   34 |     scanf(<span class="string">&quot;%d&quot;</span>, &amp;depth);</span><br><span class="line">      |</span><br><span class="line">$ ./dig1</span><br><span class="line">Today we will dig: 1000000</span><br><span class="line">Let begin!</span><br><span class="line">[1]    1727 segmentation fault  ./dig</span><br><span class="line"><span class="comment"># ----------------------------------- #</span></span><br><span class="line">$ ./dig2</span><br><span class="line">Today we will dig: 1000000</span><br><span class="line">Let begin!</span><br><span class="line">...</span><br><span class="line">In depth 999999, we use left hand</span><br><span class="line">In depth 1000000, we use right hand</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ä¸ºä»€ä¹ˆï¼Ÿ</li>
</ol>
<p>dig1å‡½æ•°ä»ç„¶æ˜¯ä½¿ç”¨äº†æ™®é€šé€’å½’çš„æ–¹å¼ï¼Œå³ä½¿å¼€O2ä¼˜åŒ–ç¼–è¯‘ï¼Œæ ˆç©ºé—´çš„é™åˆ¶ä¾ç„¶å­˜åœ¨ã€‚</p>
<p>è€Œdig2å‡½æ•°ä½¿ç”¨å°¾é€’å½’ï¼Œå¤§å¤šæ•°ç¼–è¯‘å™¨ï¼Œæ¯”å¦‚è¿™é‡Œçš„gccä¸­ï¼Œå¼€äº†O2å°¾é€’å½’å¯ä»¥è¢«ä¼˜åŒ–ä¸ºæ™®é€šå¾ªç¯å®ç°ï¼Œæ¯æ¬¡é€’å½’ä¸éœ€è¦é¢å¤–å ç”¨æ ˆå¸§ï¼Œåªéœ€å°†å‡½æ•°å‚æ•°æ”¹å˜å†è°ƒç”¨ä¸€æ¬¡ï¼Œå°±ä¸ä¼šè§¦å‘æ ˆæº¢å‡ºã€‚</p>
<ol start="3">
<li>è°ˆä¸€è°ˆè¿™é“é¢˜å¯¹ä½ åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­çš„å¯å‘ã€‚</li>
</ol>
<ul>
<li>ç”¨é€’å½’ï¼Œæ·±åº¦è¾ƒå¤§æ—¶ï¼Œè­¦æƒ•æ ˆæº¢å‡ºï¼›</li>
<li>åˆç†ä½¿ç”¨å°¾é€’å½’ï¼›</li>
<li>äº†è§£ç¼–è¯‘å™¨å’Œè¯­è¨€çš„ä¼˜åŒ–èƒ½åŠ›ï¼Œæœ‰åŠ©äºæé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ï¼›</li>
<li>developersåº”å½“ç¼–å†™å¥å£®çš„ä»£ç ï¼Œåšå¥½ä»£ç æµ‹è¯•ï¼Œå…³æ³¨è¾¹ç•Œæ¡ä»¶ã€‚</li>
</ul>
<h2 id="ğŸ§®Primes"><a href="#ğŸ§®Primes" class="headerlink" title="ğŸ§®Primes"></a>ğŸ§®Primes</h2><p>é¦™è‚ éå¸¸ç—´è¿·äºç­›æ³•æ±‚ç´ æ•°è¡¨ï¼Œå¤§è‡´åŸç†å¦‚ä¸‹<br><img src="https://pic.timlzh.com/i/2024/09/22/10eldpv.png" alt="2"></p>
<p>äºæ˜¯ä»–å…ˆç”¨ JavaScript ç¼–å†™äº†ä¸‹é¢è¿™æ ·çš„ä»£ç </p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">iota</span>(<span class="params">i, n</span>) &#123;</span><br><span class="line">  <span class="keyword">while</span> (i &lt; n) <span class="keyword">yield</span> i++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">filter</span>(<span class="params">g, p</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (x <span class="keyword">of</span> g) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x % p) <span class="keyword">yield</span> x</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">g = <span class="title function_">iota</span>(<span class="number">2</span>, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> &#123;value, done&#125; = g.<span class="title function_">next</span>()</span><br><span class="line">  <span class="keyword">if</span> (done) <span class="keyword">break</span></span><br><span class="line">  g = <span class="title function_">filter</span>(g, value)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºæˆåŠŸæ‰“å°äº† 100 ä»¥å†…çš„æ‰€æœ‰ç´ æ•°ã€‚</p>
<p>ä¸ºäº†è®©æ›´å¤šäººç†è§£è¿™æ®µä»£ç ï¼Œä»–åˆç¼–å†™äº† Python ç‰ˆæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">iota</span>(<span class="params">i, n</span>):</span><br><span class="line">    <span class="keyword">while</span> i &lt; n:</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter</span>(<span class="params">g, p</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> g:</span><br><span class="line">        <span class="keyword">if</span> x % p:</span><br><span class="line">            <span class="keyword">yield</span> x</span><br><span class="line"></span><br><span class="line">g = iota(<span class="number">2</span>, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        value = <span class="built_in">next</span>(g)</span><br><span class="line">        g = <span class="built_in">filter</span>(g, value)</span><br><span class="line">        <span class="built_in">print</span>(value)</span><br><span class="line"><span class="keyword">except</span> StopIteration:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>ç¨‹åºè™½ç„¶æ­£ç¡®ï¼Œä½† IDE ç»™å‡ºäº†è­¦å‘Šï¼šç”¨æˆ·å®šä¹‰çš„ filter å‡½æ•°éšè—äº† Python å†…ç½®çš„ filter å‡½æ•°ã€‚</p>
<p>è¯´æ¥ä¹Ÿæ˜¯ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨æ›´æ³›åŒ–çš„å†…ç½® filter å‡½æ•°å‘¢ï¼Ÿäºæ˜¯ä»–åˆæŠŠç¨‹åºæ”¹æˆäº†è¿™æ ·ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">iota</span>(<span class="params">i, n</span>):</span><br><span class="line">    <span class="keyword">while</span> i &lt; n:</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">g = iota(<span class="number">2</span>, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        value = <span class="built_in">next</span>(g)</span><br><span class="line">        g = <span class="built_in">filter</span>(<span class="keyword">lambda</span> incoming: incoming % value, g)</span><br><span class="line">        <span class="built_in">print</span>(value)</span><br><span class="line"><span class="keyword">except</span> StopIteration:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>å¾ˆé—æ†¾çš„æ˜¯ï¼Œç¨‹åºè¾“å‡ºçš„ç»“æœä¸å†æ­£ç¡®ã€‚åˆ°åº•æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜ï¼Ÿ</p>
<hr>
<p>åœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­ï¼Œé¦™è‚ è§‰å¾—ä¸èƒ½å…‰è°ƒ Python ä»£ç ï¼ŒJavaScript çš„ä¹Ÿä¸èƒ½æ”¾è¿‡ã€‚</p>
<p>è€ƒè™‘åˆ° Python é‡‡ç”¨äº†æ›´æ³›åŒ– filter å‡½æ•°ï¼Œäºæ˜¯ä»–æŠŠåŸ JavaScript ä»£ç ä¹Ÿæ”¹æˆäº†è¿™æ ·ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">iota</span>(<span class="params">i, n</span>) &#123;</span><br><span class="line">  <span class="keyword">while</span> (i &lt; n) <span class="keyword">yield</span> i++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">filter</span>(<span class="params">g, p</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (x <span class="keyword">of</span> g) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">p</span>(x)) <span class="keyword">yield</span> x</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">g = <span class="title function_">iota</span>(<span class="number">2</span>, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> &#123;value, done&#125; = g.<span class="title function_">next</span>()</span><br><span class="line">  <span class="keyword">if</span> (done) <span class="keyword">break</span></span><br><span class="line">  g = <span class="title function_">filter</span>(g, <span class="function"><span class="params">incoming</span> =&gt;</span> incoming % value)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç«Ÿç„¶å‡ºç°äº†å’Œç¬¬äºŒä»½ Python ä»£ç ä¸€æ ·çš„é”™è¯¯è¾“å‡ºç»“æœã€‚è¿™æ˜¯å·§åˆå—ï¼Ÿ</p>
<ul>
<li>æœ¬é¢˜ç­›ç´ æ•°çš„åç¨‹å«ä»€ä¹ˆåç¨‹ï¼Ÿä½ èƒ½ç®€å•æè¿°ä¸€ä¸‹è¿™æ ·ç­›ç´ æ•°çš„è¿‡ç¨‹å—ï¼Ÿ</li>
</ul>
<p>åœ¨JavaScriptæˆ–Pythonä¸­ï¼Œåˆ©ç”¨æƒ°æ€§æ±‚å€¼çš„ç”Ÿæˆå™¨ï¼Œå¯ä»¥é€æ­¥ç”Ÿæˆä¸€ä¸ªåºåˆ—ï¼Œå¹¶èƒ½åœ¨ç­›é€‰è¿‡ç¨‹ä¸­åŠ¨æ€ä¿®æ”¹åºåˆ—ï¼Œé¿å…å ç”¨è¿‡å¤šè®¡ç®—èµ„æºã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g = <span class="title function_">iota</span>(<span class="number">2</span>, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> &#123;value, done&#125; = g.<span class="title function_">next</span>()</span><br><span class="line">  <span class="keyword">if</span> (done) <span class="keyword">break</span></span><br><span class="line">  g = <span class="title function_">filter</span>(g, value)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒæ€æƒ³æ˜¯åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•ï¼ˆSieve of Eratosthenesï¼‰ã€‚ç”Ÿæˆå™¨iotaç”Ÿæˆä¸€ä¸ªä»2åˆ°99çš„æ•´æ•°åºåˆ—gï¼Œæ¯æ¬¡è°ƒç”¨gä¸­çš„å€¼å¹¶é€šè¿‡ç”Ÿæˆå™¨filterç­›æ‰ç´ æ•°valueçš„å€æ•°ï¼Œè¾“å‡ºvalueï¼Œå†ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ•°è¿›è¡Œå¾ªç¯ã€‚</p>
<ul>
<li><p>ä¸ºä»€ä¹ˆç¬¬äºŒä»½ Python å’Œç¬¬äºŒä»½ JavaScript çš„ä»£ç æœ‰é—®é¢˜ï¼Ÿä¸¤è€…çš„é—®é¢˜æ˜¯ä¸€æ ·çš„å—ï¼Ÿ</p>
</li>
<li><p>è¯·ä½ åœ¨ç¬¬äºŒä»½ Python å’Œç¬¬äºŒä»½ JavaScript åŸºç¡€ä¸Šä¿®æ”¹ä»£ç ï¼Œåœ¨ä¸å¤±ä¸€èˆ¬æ€§çš„æƒ…å†µä¸‹è§£å†³å­˜åœ¨çš„é—®é¢˜ã€‚</p>
</li>
</ul>
<p>ä¸¤è€…çš„é—®é¢˜ä¸ä¸€æ ·ã€‚</p>
<p>Pythonæ˜¯å’Œå…¶<strong>å»¶æ—¶ç»‘å®š</strong>çš„æœºåˆ¶æœ‰å…³ã€‚Pythonåœ¨çœŸæ­£æ‰§è¡Œå‡½æ•°ï¼ˆå¦‚lambdaï¼‰çš„æ—¶å€™æ‰ä¼šæŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œè€Œä¸æ˜¯åœ¨å®šä¹‰å‡½æ•°æ—¶ã€‚</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g = <span class="built_in">filter</span>(<span class="keyword">lambda</span> incoming: incoming % value, g)</span><br></pre></td></tr></table></figure>

<p>è€Œåœ¨åŒä¸€ä¸ªä½œç”¨åŸŸä¸‹ï¼Œvalueçš„å€¼å§‹ç»ˆé’ˆå¯¹åŒä¸€ä¸ªå˜é‡åœ¨å˜åŒ–ï¼Œè€Œä¸æ˜¯æ¯æ¬¡å¾ªç¯éƒ½åˆ›å»ºä¸€ä¸ªæ–°å˜é‡ã€‚å› æ­¤ï¼Œæ‰€æœ‰çš„lambdaä¸­å¼•ç”¨çš„valueéƒ½ä¼šä½¿ç”¨æœ€æ–°çš„å€¼ã€‚</p>
<p>å¯ä»¥é‡‡ç”¨<strong>é»˜è®¤å‚æ•°</strong>çš„æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">iota</span>(<span class="params">i, n</span>):</span><br><span class="line">    <span class="keyword">while</span> i &lt; n:</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">g = iota(<span class="number">2</span>, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        value = <span class="built_in">next</span>(g)</span><br><span class="line">        g = <span class="built_in">filter</span>(<span class="keyword">lambda</span> incoming, value=value: incoming % value, g)</span><br><span class="line">        <span class="built_in">print</span>(value)</span><br><span class="line"><span class="keyword">except</span> StopIteration:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œå‚æ•°åªä¼šåˆå§‹åŒ–ä¸€æ¬¡ï¼Œè€Œåœ¨ä¹‹åçš„å¾ªç¯ä¸­ä¿æŒä¸å˜ã€‚</p>
<p>æ‰‹åŠ¨å³æ—¶æ•è·ã€‚</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">iota</span>(<span class="params">i, n</span>):</span><br><span class="line">    <span class="keyword">while</span> i &lt; n:</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">g = iota(<span class="number">2</span>, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        value = <span class="built_in">next</span>(g)</span><br><span class="line">        g = <span class="built_in">filter</span>((<span class="keyword">lambda</span> value: <span class="keyword">lambda</span> incoming: incoming % value)(value), g)</span><br><span class="line">        <span class="built_in">print</span>(value)</span><br><span class="line"><span class="keyword">except</span> StopIteration:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>è€ŒJavaScriptæ˜¯ä¸varçš„ä½œç”¨åŸŸè§„åˆ™æœ‰å…³ã€‚varåœ¨JavaScriptä¸­çš„ä½œç”¨åŸŸæ˜¯å‡½æ•°ä½œç”¨åŸŸï¼Œè€Œä¸æ˜¯å—ä½œç”¨åŸŸã€‚å¾ªç¯ä½“ä¸­æ¯æ¬¡å£°æ˜çš„valueå®é™…ä¸Šä¼šåœ¨æ•´ä¸ªå‡½æ•°çš„ä½œç”¨åŸŸä¸­å…±äº«ï¼Œlambdaå‡½æ•°æ•è·çš„æ˜¯å¯¹åŒä¸€ä¸ªå˜é‡çš„å¼•ç”¨ï¼Œæ‰€ä»¥valueä¼šåœ¨æ¯æ¬¡å¾ªç¯åæ›´æ–°ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ <code>let</code> ä»£æ›¿ <code>var</code>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">iota</span>(<span class="params">i, n</span>) &#123;</span><br><span class="line">  <span class="keyword">while</span> (i &lt; n) <span class="keyword">yield</span> i++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">filter</span>(<span class="params">g, p</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (x <span class="keyword">of</span> g) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">p</span>(x)) <span class="keyword">yield</span> x</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">g = <span class="title function_">iota</span>(<span class="number">2</span>, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123;value, done&#125; = g.<span class="title function_">next</span>()</span><br><span class="line">  <span class="keyword">if</span> (done) <span class="keyword">break</span></span><br><span class="line">  g = <span class="title function_">filter</span>(g, <span class="function"><span class="params">incoming</span> =&gt;</span> incoming % value)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸º <code>let</code> æ˜¯å—ä½œç”¨åŸŸï¼Œåœ¨æ¯æ¬¡å¾ªç¯ä¸­ä¼šä¸º <code>value</code> ç»‘å®šä¸€ä¸ªæ–°çš„å˜é‡ï¼Œè¿™æ ·æ¯ä¸ª lambda å‡½æ•°éƒ½èƒ½æ•è·åˆ°å½“å‰å¾ªç¯ä¸­çš„ <code>value</code>ï¼Œè€Œä¸æ˜¯å…±äº«çš„å…¨å±€å˜é‡ã€‚</p>
<h2 id="â­æ•°æ•°"><a href="#â­æ•°æ•°" class="headerlink" title="â­æ•°æ•°"></a>â­æ•°æ•°</h2><blockquote>
<p>è®¡ç®—æœºå¾€å¾€ä¸å¤Ÿèªæ˜ï¼ˆæˆ–è€…å¤ªè¿‡èªæ˜ï¼‰ï¼Œä»¥è‡³äºä»–åªä¼šå®Œå…¨æŒ‰ç…§ä½ çš„æŒ‡ä»¤åŠäº‹ï¼Œå°½ç®¡æœ‰æ—¶å€™ä½ è‡ªå·±éƒ½ä¸çŸ¥é“è‡ªå·±çš„æŒ‡ä»¤æ˜¯ä»€ä¹ˆå«ä¹‰</p>
</blockquote>
<h3 id="CH1-3"><a href="#CH1-3" class="headerlink" title="CH1"></a>CH1</h3><p>è¿™é“é¢˜ç›®å¹¶ä¸éš¾ï¼Œä½ è¦åšçš„åªæ˜¯è®©è®¡ç®—æœºå­¦ä¼šæ•°æ•°è€Œå·²ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> work_load;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">worker</span><span class="params">(<span class="type">void</span> *counter_ptr)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; work_load; i++) &#123;</span><br><span class="line">        (* (<span class="type">int</span> *)counter_ptr) += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;give the workload per thread: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;work_load);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> counter;</span><br><span class="line"></span><br><span class="line">    worker(&amp;counter);</span><br><span class="line">    worker(&amp;counter);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Totally count: %d\n&quot;</span>, counter);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ååˆ†ç®€å•å¯¹å§ï¼Ÿä½†æ˜¯æŸ³è‹æ˜å´è®¤ä¸ºï¼Œè®©åŒä¸€ä¸ª <code>worker</code>å‡½æ•°è¿è¡Œä¸¤éæ•ˆç‡å¤ªä½äº†ã€‚ä¸ºä»€ä¹ˆä¸é›‡ä½£ä¸¤ä¸ª <code>worker</code>ï¼Œ è®©ä»–ä»¬åŒæ—¶å·¥ä½œå‘¢ï¼Ÿæ¢å¥è¯è¯´ï¼Œä»–å†³å®šä½¿ç”¨ <strong>å¤šçº¿ç¨‹</strong>ï¼</p>
<p>äºæ˜¯ä»–ååˆ†å¥½å¿ƒçš„ç»™äº†ä½ ä¸¤ä»½ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// V1</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> work_load;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">worker</span><span class="params">(<span class="type">void</span> *counter_ptr)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; work_load; i++) &#123;</span><br><span class="line">        (* (<span class="type">int</span> *)counter_ptr) += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;give the workload per thread: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;work_load);</span><br><span class="line"></span><br><span class="line">    <span class="type">pthread_t</span> thread1, thread2;</span><br><span class="line">    <span class="type">int</span> counter1, counter2;</span><br><span class="line"></span><br><span class="line">    pthread_create(&amp;thread1, <span class="literal">NULL</span>, worker, &amp;counter1);</span><br><span class="line">    pthread_create(&amp;thread2, <span class="literal">NULL</span>, worker, &amp;counter2);</span><br><span class="line"></span><br><span class="line">    pthread_join(thread1, <span class="literal">NULL</span>);</span><br><span class="line">    pthread_join(thread2, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Totally count: %d\n&quot;</span>, counter1 + counter2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//V2</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> work_load;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">worker</span><span class="params">(<span class="type">void</span> *counter_ptr)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; work_load; i++) &#123;</span><br><span class="line">        (* (<span class="type">int</span> *)counter_ptr) += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;give the workload per thread: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;work_load);</span><br><span class="line"></span><br><span class="line">    <span class="type">pthread_t</span> thread1, thread2;</span><br><span class="line">    <span class="type">int</span> counter;</span><br><span class="line"></span><br><span class="line">    pthread_create(&amp;thread1, <span class="literal">NULL</span>, worker, &amp;counter);</span><br><span class="line">    pthread_create(&amp;thread2, <span class="literal">NULL</span>, worker, &amp;counter);</span><br><span class="line"></span><br><span class="line">    pthread_join(thread1, <span class="literal">NULL</span>);</span><br><span class="line">    pthread_join(thread2, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Totally count: %d\n&quot;</span>, counter);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†é—®é¢˜å‡ºç°äº†ï¼Œå°½ç®¡ç¬¬ä¸€ä»½ä»£ç å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†ç¬¬äºŒä»½ä»£ç åœ¨ <strong>è¾“å…¥å€¼å¾ˆå¤§</strong> æ—¶æ€»æ˜¯å‡ºç°å¥‡æ€ªçš„åå·®ã€‚</p>
<p>å°è¯•è¿è¡Œæµ‹è¯•è¿™ä¸¤æ®µä»£ç ï¼Œå›ç­”ï¼š</p>
<ol>
<li>ä¸ºä»€ä¹ˆä¸¤ä»½ç›¸ä¼¼çš„ä»£ç ä¼šæœ‰ä¸åŒçš„è¾“å‡ºç»“æœï¼Ÿ</li>
</ol>
<p>V1ä¸­æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹åœ°æ“ä½œå„è‡ªçš„counter1å’Œcounter2ï¼Œäº’ä¸å¹²æ‰°ï¼Œæœ€ç»ˆæŠŠä¸¤ä¸ªè®¡æ•°å™¨çš„ç»“æœåŠ å’Œå¾—åˆ°ç­”æ¡ˆã€‚</p>
<p>V2ä¸­é€šè¿‡å¤šçº¿ç¨‹å¹¶å‘åœ°å¯¹åŒä¸€å˜é‡counterè¿›è¡Œä¿®æ”¹ï¼Œè¿™ç§æ“ä½œå­˜åœ¨ç«äº‰æ¡ä»¶ã€‚æ„å‘³ç€ä¸¤ä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶è¯»å†™å…±äº«å˜é‡counterï¼Œå¯¼è‡´è®¡æ•°ä¸å‡†ç¡®ï¼Œå°¤å…¶æ˜¯åœ¨å·¥ä½œè´Ÿè·è¾ƒå¤§çš„æ—¶å€™ã€‚</p>
<ol start="2">
<li>åœ¨ç¼–å†™å¤šçº¿ç¨‹ä»£ç æ—¶ï¼Œå¦‚ä½•é¿å…è¿™ç§é”™è¯¯ï¼Ÿ</li>
</ol>
<p>å¼•å…¥åŒæ­¥æœºåˆ¶ï¼Œä½¿ç”¨äº’æ–¥é”æ¥ä¿è¯çº¿ç¨‹çš„ç‹¬ç«‹è®¿é—®ï¼Œç¡®ä¿åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ“ä½œå˜é‡ï¼Œé¿å…ç«äº‰æ¡ä»¶ã€‚</p>
<ol start="3">
<li>å°è¯•åªä¿®æ”¹ <code>worker</code> å‡½æ•°æ¥ä½¿ç¬¬äºŒä»½ä»£ç è¾“å‡ºæ­£ç¡®ã€‚</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//V2</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> work_load; </span><br><span class="line"><span class="type">pthread_mutex_t</span> lock; <span class="comment">//é”çš„å£°æ˜</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">worker</span><span class="params">(<span class="type">void</span> *counter_ptr)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; work_load; i++) &#123;</span><br><span class="line">        pthread_mutex_lock(&amp;lock); <span class="comment">//ä¸Šé”</span></span><br><span class="line">        (* (<span class="type">int</span> *)counter_ptr) += <span class="number">1</span>;</span><br><span class="line">        pthread_mutex_unlock(&amp;lock); <span class="comment">//è§£é”</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;give the workload per thread: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;work_load);</span><br><span class="line"></span><br><span class="line">    <span class="type">pthread_t</span> thread1, thread2;</span><br><span class="line">    <span class="type">int</span> counter;</span><br><span class="line">    pthread_mutex_init(&amp;lock, <span class="literal">NULL</span>); <span class="comment">//é”çš„åˆå§‹åŒ–</span></span><br><span class="line">    </span><br><span class="line">    pthread_create(&amp;thread1, <span class="literal">NULL</span>, worker, &amp;counter);</span><br><span class="line">    pthread_create(&amp;thread2, <span class="literal">NULL</span>, worker, &amp;counter);</span><br><span class="line"></span><br><span class="line">    pthread_join(thread1, <span class="literal">NULL</span>);</span><br><span class="line">    pthread_join(thread2, <span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    pthread_mutex_destroy(&amp;lock); <span class="comment">//é”€æ¯</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Totally count: %d\n&quot;</span>, counter);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œä¸€ä¸‹ï¼Œå¯¹æ¯”æ›´æ”¹å‰åï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ./count</span><br><span class="line">give the workload per thread: 1000000000</span><br><span class="line">Totally count: 1007291379</span><br><span class="line"><span class="comment">#------------------------------------------#</span></span><br><span class="line">$ ./count</span><br><span class="line">give the workload per thread: 1000000000</span><br><span class="line">Totally count: 2000000000</span><br></pre></td></tr></table></figure>



<h3 id="CH2-3"><a href="#CH2-3" class="headerlink" title="CH2"></a>CH2</h3><p>äº†è§£â€äº’æ–¥é”â€è¿™ä¸ªæ¦‚å¿µï¼Œæ€è€ƒï¼š</p>
<blockquote>
<p>ä¸¤ä¸ªçº¿ç¨‹éƒ½åŒæ—¶è®¿é—®äº†åŒä¸€ä¸ªå˜é‡ï¼šäº’æ–¥é”</p>
<p>å¯¹äºäº’æ–¥é”çš„è®¿é—®éš¾é“ä¸ä¼šäº§ç”Ÿæ•°æ®ç«äº‰å—ï¼Ÿ</p>
</blockquote>
<p>å›ç­”:</p>
<ol>
<li>ä¸ºä»€ä¹ˆè®¿é—®äº’æ–¥é”ä¸ä¼šäº§ç”Ÿæ•°æ®ç«äº‰ï¼Ÿ</li>
<li>è¯·å°è¯•è‡ªå·±ç¼–å†™ä¸€ä¸ªäº’æ–¥é”(é¢å¤–åŠ åˆ†)</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://imageslr.com/2020/locks.html">ã€æ“ä½œç³»ç»Ÿã€‘é”çš„å®ç°</a></p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹è·å–äº’æ–¥é”æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å°è¯•è·å–å¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹é‡Šæ”¾é”ã€‚äº’æ–¥é”çš„å®ç°ç”±åº•å±‚ç¡¬ä»¶æˆ–æ“ä½œç³»ç»Ÿæ”¯æŒï¼Œé€šå¸¸é€šè¿‡æŸç§åŸå­æ“ä½œï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…¶ä»–çº¿ç¨‹æŒæœ‰çš„é”æ—¶ï¼Œä¼šè¢« OS è°ƒåº¦ä¸ºé˜»å¡çŠ¶æ€ï¼ˆä¼‘çœ ï¼‰ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾åï¼Œå†å”¤é†’ä¸€ä¸ªä¼‘çœ çš„çº¿ç¨‹ã€‚</p>
<p>ï¼ˆå¦å¤–ï¼Œè‡ªæ—‹é”æ˜¯ä¸€ç§å¿™ç­‰å¾…é”ã€‚å®ƒåœ¨é”è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰æ—¶ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œè€Œæ˜¯ä¸æ–­åœ°å°è¯•è·å–é”ï¼Œç›´åˆ°é”å¯ç”¨ä¸ºæ­¢ã€‚è¿™ç§å¿™ç­‰å¾…çš„è¡Œä¸ºç§°ä¸ºâ€œè‡ªæ—‹â€ã€‚ï¼‰</p>
<p>ä½¿ç”¨äº†åŸå­æ“ä½œæ¥å®ç°äº’æ–¥é”çš„åŠ é”å’Œè§£é”é€»è¾‘ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">atomic_int</span> lock_flag;</span><br><span class="line">&#125; <span class="type">my_mutex_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">my_mutex_init</span><span class="params">(<span class="type">my_mutex_t</span> *mutex)</span> &#123;</span><br><span class="line">    <span class="type">atomic_store</span>(&amp;mutex-&gt;lock_flag, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">my_mutex_lock</span><span class="params">(<span class="type">my_mutex_t</span> *mutex)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (atomic_exchange(&amp;mutex-&gt;lock_flag, <span class="number">1</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">        sched_yield() <span class="comment">//æŒ‚èµ·ï¼Œè€Œéå¿™ç­‰å¾…</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">my_mutex_unlock</span><span class="params">(<span class="type">my_mutex_t</span> *mutex)</span> &#123;</span><br><span class="line">    <span class="type">atomic_store</span>(&amp;mutex-&gt;lock_flag, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®Œæ•´ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdatomic.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sched.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">atomic_int</span> lock_flag;</span><br><span class="line">&#125; <span class="type">my_mutex_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">my_mutex_init</span><span class="params">(<span class="type">my_mutex_t</span> *mutex)</span> &#123;</span><br><span class="line">    <span class="type">atomic_store</span>(&amp;mutex-&gt;lock_flag, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">my_mutex_lock</span><span class="params">(<span class="type">my_mutex_t</span> *mutex)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (atomic_exchange(&amp;mutex-&gt;lock_flag, <span class="number">1</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">        sched_yield();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">my_mutex_unlock</span><span class="params">(<span class="type">my_mutex_t</span> *mutex)</span> &#123;</span><br><span class="line">    <span class="type">atomic_store</span>(&amp;mutex-&gt;lock_flag, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> work_load;</span><br><span class="line"><span class="type">my_mutex_t</span> my_mutex;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">worker</span><span class="params">(<span class="type">void</span> *counter_ptr)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; work_load; i++) &#123;</span><br><span class="line">        my_mutex_lock(&amp;my_mutex);</span><br><span class="line">        (*(<span class="type">int</span> *)counter_ptr) += <span class="number">1</span>;</span><br><span class="line">        my_mutex_unlock(&amp;my_mutex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;give the workload per thread: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;work_load);</span><br><span class="line"></span><br><span class="line">    <span class="type">pthread_t</span> thread1, thread2;</span><br><span class="line">    <span class="type">int</span> counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    my_mutex_init(&amp;my_mutex);</span><br><span class="line"></span><br><span class="line">    pthread_create(&amp;thread1, <span class="literal">NULL</span>, worker, &amp;counter);</span><br><span class="line">    pthread_create(&amp;thread2, <span class="literal">NULL</span>, worker, &amp;counter);</span><br><span class="line"></span><br><span class="line">    pthread_join(thread1, <span class="literal">NULL</span>);</span><br><span class="line">    pthread_join(thread2, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Totally count: %d\n&quot;</span>, counter);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="ğŸ“ŸBitter"><a href="#ğŸ“ŸBitter" class="headerlink" title="ğŸ“ŸBitter"></a>ğŸ“ŸBitter</h2><h3 id="CH1-4"><a href="#CH1-4" class="headerlink" title="CH1"></a>CH1</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BOARD_SIZE 8</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> upper_lim = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* int row: store the valid bit after applying the vertical rule</span></span><br><span class="line"><span class="comment">* int ld: store the valid bit after applying the left diagram rule</span></span><br><span class="line"><span class="comment">* int rd: store the valid bit after applying the right diagram rule</span></span><br><span class="line"><span class="comment">* bit &#x27;0&#x27; represent where we can place a chess</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">solve_problem</span><span class="params">(<span class="type">int</span> row ,<span class="type">int</span> ld, <span class="type">int</span> rd)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>( row == upper_lim) &#123;</span><br><span class="line">        count += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* &#x27;current&#x27; represent all the valid bit*/</span></span><br><span class="line">    <span class="type">int</span> current = upper_lim &amp; (~ (row | ld | rd));</span><br><span class="line">    <span class="type">int</span> buffer = current;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(buffer) &#123;</span><br><span class="line">        <span class="type">int</span> valid = buffer &amp; (-buffer);</span><br><span class="line">        buffer -= valid;</span><br><span class="line"></span><br><span class="line">        solve_problem(row|valid, (ld|valid)&lt;&lt;<span class="number">1</span>, (rd|valid)&gt;&gt;<span class="number">1</span>); <span class="comment">///////////////////////////////////////</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* board_size shouldn&#x27;t be too large */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">find_n_th_queen</span><span class="params">(<span class="type">int</span> board_size )</span> &#123;</span><br><span class="line">    upper_lim = (<span class="number">1</span> &lt;&lt; board_size) - <span class="number">1</span>;</span><br><span class="line">    solve_problem(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    find_n_th_queen(BOARD_SIZE);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Answer: %d&quot;</span>, count);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Answer: 92</span></span><br></pre></td></tr></table></figure>

<h3 id="CH2-4"><a href="#CH2-4" class="headerlink" title="CH2"></a>CH2</h3><p>ç”¨ä½æ¥æ ‡è®°æ•°ç»„å…ƒç´ çš„çŠ¶æ€ã€‚</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">nums</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(nums)</span><br><span class="line">    states = <span class="number">1</span> &lt;&lt; n</span><br><span class="line">    max_sum = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> state <span class="keyword">in</span> <span class="built_in">range</span>(states):</span><br><span class="line">        valid = <span class="literal">True</span></span><br><span class="line">        curr_sum = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            <span class="keyword">if</span> state &amp; (<span class="number">1</span> &lt;&lt; i): <span class="comment">#choose ith element</span></span><br><span class="line">                curr_sum += nums[i]</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> (state &amp; (<span class="number">1</span> &lt;&lt; (i - <span class="number">1</span>))): <span class="comment">#conflict</span></span><br><span class="line">                    valid = <span class="literal">False</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> valid:</span><br><span class="line">            max_sum = <span class="built_in">max</span>(max_sum, curr_sum)</span><br><span class="line">    <span class="keyword">return</span> max_sum</span><br><span class="line"></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">19</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">17</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">13</span>, <span class="number">18</span>, <span class="number">16</span>, <span class="number">20</span>]</span><br><span class="line"><span class="built_in">print</span>(solve(nums))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">130</span></span><br><span class="line"><span class="string">[Done] exited with code=0 in 0.965 seconds</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>åŠ¨æ€è§„åˆ’å¯ä»¥æ˜¾è‘—é™ä½æ—¶é—´ã€‚</p>
<ul>
<li>åŠ å¯†ç®—æ³•ï¼šAESä¸­å­˜åœ¨è¡Œç§»ä½ï¼Œå“ˆå¸Œç®—æ³•ä¼šä½¿ç”¨ä½ç§»ã€å¼‚æˆ–æ“ä½œï¼Œæä¾›å®‰å…¨æ€§</li>
<li>å¿«é€Ÿè¿ç®—ï¼šä½ç§»æ“ä½œå¿«é€Ÿè®¡ç®—ï¼Œå¥‡å¶åˆ¤æ–­ï¼ŒèŠ‚çº¦æ—¶é—´ï¼Œbitsetç­›ç´ æ•°å¯èŠ‚çœç©ºé—´</li>
<li>æ–‡ä»¶æƒé™ï¼šä½¿ç”¨ä½è¿ç®—å¯ä»¥æ–¹ä¾¿åœ°å¼€å¯æˆ–å…³é—­æŸäº›æ ‡å¿—ä½</li>
<li>å¹¶è¡Œè®¡ç®—ï¼šä½è¿ç®—å¯ä»¥å¿«é€Ÿåœ°å¯ç”¨æˆ–ç¦ç”¨æŸä¸ªçº¿ç¨‹æˆ–è€…æ£€æŸ¥æŸä¸ªçº¿ç¨‹çš„çŠ¶æ€</li>
</ul>
<h2 id="ğŸ©é¡ºæ‰‹ç‰µç¾Š"><a href="#ğŸ©é¡ºæ‰‹ç‰µç¾Š" class="headerlink" title="ğŸ©é¡ºæ‰‹ç‰µç¾Š"></a>ğŸ©é¡ºæ‰‹ç‰µç¾Š</h2><p><strong>è¦æ±‚ï¼š</strong>ä½¿ç”¨Cè¯­è¨€å®ç°ä¸€ä¸ªè‡ªå·±çš„æŠ“åŒ…è½¯ä»¶</p>
<ol>
<li>ä½¿ç”¨<code>libpcap</code>åº“å®ç°æŠ“åŒ…ã€‚</li>
<li>ç¨‹åºåº”è¯¥å®ç°ï¼šåˆ¤æ–­å¹¶è¾“å‡ºæ¯ä¸ªåŒ…çš„ç±»å‹ï¼ŒåŒ…çš„é•¿åº¦ï¼Œä»¥åŠåŒ…çš„æºåœ°å€å’Œç›®çš„åœ°å€ã€‚</li>
</ol>
<p>å¦‚æœä½ èƒ½å®ç°å¯¹äºTCPåŒ…çš„æ•è·ï¼Œå¯ä»¥è·å¾—70%çš„åˆ†æ•°ã€‚å¦‚æœä½ èƒ½å®ç°è‡³å°‘ä¸‰ç§åŒ…çš„åˆ†ææ•è·ï¼Œå¯ä»¥è·å¾—å‰©ä¸‹30%çš„åˆ†æ•°ã€‚</p>
<p>ç®€å•é˜è¿°ä¸‹ä½ å¯¹æŠ“åŒ…çš„å®ç°åŸç†çš„ç†è§£ï¼Œæœ€é«˜å¯å¾—é¢å¤–çš„20%åˆ†æ•°ã€‚</p>
<p><strong>hintï¼š</strong>è¦ä¸ä¸‹è½½ä¸€ä¸ªwiresharkä½“éªŒä¸‹æŠ“åŒ…ï¼Ÿ</p>
<hr>
<p><strong>é¢˜è§£ï¼š</strong></p>
<p>åœ¨Cè¯­è¨€ä¸­ä½¿ç”¨libpcapåº“æ¥è¿›è¡ŒæŠ“åŒ…æ“ä½œã€‚</p>
<p>å®‰è£…libpcapåº“ï¼›</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install libpcap-dev</span><br></pre></td></tr></table></figure>

<p>å®ç°å¯¹TCPåŒ…çš„æ•è·ï¼›</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pcap.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span> <span class="comment">//æä¾›äº†IPåœ°å€çš„è½¬æ¢å‡½æ•°</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/ip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/tcp.h&gt;</span> <span class="comment">//å®šä¹‰äº†IPå’ŒTCPå¤´éƒ¨çš„ç»“æ„ä½“</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å›è°ƒå‡½æ•°åœ¨æ¯æ¬¡æ•è·åˆ°æ•°æ®åŒ…æ—¶è¢«è°ƒç”¨</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">packet_handler</span><span class="params">(u_char *user_data, <span class="type">const</span> <span class="keyword">struct</span> pcap_pkthdr *pkthdr, <span class="type">const</span> u_char *packet)</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ip</span> *<span class="title">ip_header</span> =</span> (<span class="keyword">struct</span> ip *)(packet + <span class="number">14</span>); <span class="comment">//è·³è¿‡ä»¥å¤ªç½‘å¸§å¤´(14)ã€è·å–ipå¤´</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tcphdr</span> *<span class="title">tcp_header</span> =</span> (<span class="keyword">struct</span> tcphdr *)(packet + <span class="number">14</span> + ip_header-&gt;ip_hl * <span class="number">4</span>); <span class="comment">//è·å–TCPå¤´</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&lt;--------- New Packet Arrived! ---------&gt;\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Total packet available: %d bytes\n&quot;</span>, pkthdr-&gt;len);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Expected packet size: %d bytes\n&quot;</span>, pkthdr-&gt;len);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;IP header length (IHL) in bytes: %d\n&quot;</span>, ip_header-&gt;ip_hl * <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Source Address: %s\n&quot;</span>, inet_ntoa(ip_header-&gt;ip_src));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Destination Address: %s\n&quot;</span>, inet_ntoa(ip_header-&gt;ip_dst));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;TCP header length in bytes: %d\n&quot;</span>, tcp_header-&gt;th_off * <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Size of all headers combined: %d bytes\n&quot;</span>, ip_header-&gt;ip_hl * <span class="number">4</span> + tcp_header-&gt;th_off * <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Payload size: %d bytes\n&quot;</span>, pkthdr-&gt;len - (ip_header-&gt;ip_hl * <span class="number">4</span> + tcp_header-&gt;th_off * <span class="number">4</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;---------------------------------------\n&quot;</span>);</span><br><span class="line">&#125; <span class="comment">//ä¸‰ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤ºï¼šç”¨æˆ·ä¼ é€’çš„æ•°æ®ã€æ•°æ®åŒ…å¤´éƒ¨ä¿¡æ¯ã€æŒ‡å‘å®é™…çš„æ•°æ®åŒ…å†…å®¹</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> errbuf[PCAP_ERRBUF_SIZE];</span><br><span class="line">    <span class="type">pcap_if_t</span> *alldevs;</span><br><span class="line">    <span class="type">pcap_if_t</span> *device;</span><br><span class="line">    <span class="type">pcap_t</span> *handle;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨å‡½æ•°è·å–æ‰€æœ‰å¯ç”¨è®¾å¤‡åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">if</span> (pcap_findalldevs(&amp;alldevs, errbuf) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Error finding devices: %s\n&quot;</span>, errbuf);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€‰æ‹©ç¬¬ä¸€ä¸ªè®¾å¤‡</span></span><br><span class="line">    device = alldevs;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Using device: %s\n&quot;</span>, device-&gt;name);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å¼€è®¾å¤‡</span></span><br><span class="line">    handle = pcap_open_live(device-&gt;name, BUFSIZ, <span class="number">1</span>, <span class="number">1000</span>, errbuf);</span><br><span class="line">    </span><br><span class="line">    pcap_loop(handle, <span class="number">0</span>, packet_handler, <span class="literal">NULL</span>); <span class="comment">//æ•è·æ•°æ®åŒ…ï¼Œå›è°ƒ</span></span><br><span class="line">    </span><br><span class="line">    pcap_freealldevs(alldevs);</span><br><span class="line">    pcap_close(handle);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œä¸Šè¿°ä»£ç ï¼Œæ‰“å¼€firefoxï¼Œæ•è·åˆ°æ•°æ®åŒ…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -o packet_sniffer packet_sniffer -lpcap</span><br><span class="line">$ <span class="built_in">sudo</span> ./packet_sniffer</span><br><span class="line">Using device: loopback0</span><br><span class="line">&lt;--------- New Packet Arrived! ---------&gt;</span><br><span class="line">Total packet available: 1514 bytes</span><br><span class="line">Expected packet size: 1514 bytes</span><br><span class="line">IP header length (IHL) <span class="keyword">in</span> bytes: 20</span><br><span class="line">Source Address: 127.0.0.1</span><br><span class="line">Destination Address: 127.0.0.1</span><br><span class="line">TCP header length <span class="keyword">in</span> bytes: 32</span><br><span class="line">Size of all headers combined: 52 bytes</span><br><span class="line">Payload size: 1462 bytes</span><br><span class="line">---------------------------------------</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>è¿™äº›æ•°æ®åŒ…æ˜¯åœ¨ WSL 2 å†…éƒ¨é€šè¿‡ loopback æ¥å£è¿›è¡Œçš„æœ¬åœ°é€šä¿¡ï¼Œæºå¤´å’Œç›®çš„åœ°éƒ½æ˜¯127.0.0.1ã€‚æŸ¥æ‰¾ç½‘ç»œæ¥å£ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ip addr</span><br><span class="line">...</span><br><span class="line">4: loopback0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:15:5d:78:40:b2 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: eth2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether e0:2e:0b:08:09:53 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.0.144/24 brd 192.168.0.255 scope global noprefixroute eth2</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::66a7:f661:86e5:c634/64 scope <span class="built_in">link</span> nodad noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>å‘ç°<code>eth2</code>æ˜¯å½“å‰å”¯ä¸€çŠ¶æ€ä¸º <code>UP</code> ä¸”é…ç½®äº† IP åœ°å€çš„æ¥å£ï¼Œæ˜¯WSLä¸»è¦ç”¨äºä¸å¤–éƒ¨ç½‘ç»œé€šä¿¡çš„æ¥å£ã€‚ä¿®æ”¹ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾åä¸º &quot;eth2&quot; çš„è®¾å¤‡</span></span><br><span class="line">    <span class="keyword">for</span> (device = alldevs; device != <span class="literal">NULL</span>; device = device-&gt;next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(device-&gt;name, <span class="string">&quot;eth2&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            found = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!found) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Device eth2 not found. Make sure you have the necessary permissions.\n&quot;</span>);</span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;--------- New Packet Arrived! ---------&gt;</span><br><span class="line">Total packet available: 66 bytes</span><br><span class="line">Expected packet size: 66 bytes</span><br><span class="line">IP header length (IHL) <span class="keyword">in</span> bytes: 20</span><br><span class="line">Source Address: 192.168.0.144</span><br><span class="line">Destination Address: 34.107.243.93</span><br><span class="line">TCP header length <span class="keyword">in</span> bytes: 32</span><br><span class="line">Size of all headers combined: 52 bytes</span><br><span class="line">Payload size: 14 bytes</span><br><span class="line">---------------------------------------</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>å®ç°å¯¹TCPã€UDPå’ŒICMPä¸‰ç§åŒ…çš„æ•è·ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pcap.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/ip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/tcp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/udp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/ip_icmp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å›è°ƒå‡½æ•°ï¼Œç”¨äºå¤„ç†æ•è·çš„æ•°æ®åŒ…</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">packet_handler</span><span class="params">(u_char *user_data, <span class="type">const</span> <span class="keyword">struct</span> pcap_pkthdr *pkthdr, <span class="type">const</span> u_char *packet)</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ip</span> *<span class="title">ip_header</span> =</span> (<span class="keyword">struct</span> ip *)(packet + <span class="number">14</span>); <span class="comment">// è·³è¿‡ä»¥å¤ªç½‘å¤´éƒ¨ï¼ˆEthernet headerï¼‰</span></span><br><span class="line">    <span class="type">int</span> ip_header_length = ip_header-&gt;ip_hl * <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&lt;--------- New Packet Arrived! ---------&gt;\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Total packet available: %d bytes\n&quot;</span>, pkthdr-&gt;len);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Expected packet size: %d bytes\n&quot;</span>, pkthdr-&gt;len);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;IP header length (IHL) in bytes: %d\n&quot;</span>, ip_header_length);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Source Address: %s\n&quot;</span>, inet_ntoa(ip_header-&gt;ip_src));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Destination Address: %s\n&quot;</span>, inet_ntoa(ip_header-&gt;ip_dst));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥IPåŒ…çš„åè®®å­—æ®µä»¥ç¡®å®šå…¶ç±»å‹</span></span><br><span class="line">    <span class="keyword">switch</span> (ip_header-&gt;ip_p) &#123;</span><br><span class="line">        <span class="keyword">case</span> IPPROTO_TCP: &#123;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">tcphdr</span> *<span class="title">tcp_header</span> =</span> (<span class="keyword">struct</span> tcphdr *)(packet + <span class="number">14</span> + ip_header_length);</span><br><span class="line">            <span class="type">int</span> tcp_header_length = tcp_header-&gt;th_off * <span class="number">4</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Protocol: TCP\n&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;TCP header length in bytes: %d\n&quot;</span>, tcp_header_length);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Size of all headers combined: %d bytes\n&quot;</span>, ip_header_length + tcp_header_length);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Payload size: %d bytes\n&quot;</span>, pkthdr-&gt;len - (ip_header_length + tcp_header_length));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> IPPROTO_UDP: &#123;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">udphdr</span> *<span class="title">udp_header</span> =</span> (<span class="keyword">struct</span> udphdr *)(packet + <span class="number">14</span> + ip_header_length);</span><br><span class="line">            <span class="type">int</span> udp_header_length = <span class="number">8</span>; <span class="comment">// UDP header å›ºå®šé•¿åº¦ä¸º 8 å­—èŠ‚</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Protocol: UDP\n&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;UDP header length in bytes: %d\n&quot;</span>, udp_header_length);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Size of all headers combined: %d bytes\n&quot;</span>, ip_header_length + udp_header_length);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Payload size: %d bytes\n&quot;</span>, ntohs(udp_header-&gt;len) - udp_header_length);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> IPPROTO_ICMP: &#123;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">icmphdr</span> *<span class="title">icmp_header</span> =</span> (<span class="keyword">struct</span> icmphdr *)(packet + <span class="number">14</span> + ip_header_length);</span><br><span class="line">            <span class="type">int</span> icmp_header_length = <span class="number">8</span>; <span class="comment">// ICMP header é€šå¸¸ä¸º 8 å­—èŠ‚</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Protocol: ICMP\n&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;ICMP header length in bytes: %d\n&quot;</span>, icmp_header_length);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Size of all headers combined: %d bytes\n&quot;</span>, ip_header_length + icmp_header_length);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Payload size: %d bytes\n&quot;</span>, pkthdr-&gt;len - (ip_header_length + icmp_header_length));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Protocol: Other\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;---------------------------------------\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> errbuf[PCAP_ERRBUF_SIZE];</span><br><span class="line">    <span class="type">pcap_if_t</span> *alldevs;</span><br><span class="line">    <span class="type">pcap_if_t</span> *device;</span><br><span class="line">    <span class="type">pcap_t</span> *handle;</span><br><span class="line">    <span class="type">int</span> found = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ pcap_findalldevs æ¥è·å–æ‰€æœ‰å¯ç”¨è®¾å¤‡</span></span><br><span class="line">    <span class="keyword">if</span> (pcap_findalldevs(&amp;alldevs, errbuf) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Error finding devices: %s\n&quot;</span>, errbuf);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾åä¸º &quot;eth2&quot; çš„è®¾å¤‡</span></span><br><span class="line">    <span class="keyword">for</span> (device = alldevs; device != <span class="literal">NULL</span>; device = device-&gt;next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(device-&gt;name, <span class="string">&quot;eth2&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            found = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!found) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Device eth2 not found. Make sure you have the necessary permissions.\n&quot;</span>);</span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Using device: %s\n&quot;</span>, device-&gt;name);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å¼€è®¾å¤‡</span></span><br><span class="line">    handle = pcap_open_live(device-&gt;name, BUFSIZ, <span class="number">1</span>, <span class="number">1000</span>, errbuf);</span><br><span class="line">    <span class="keyword">if</span> (handle == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Could not open device %s: %s\n&quot;</span>, device-&gt;name, errbuf);</span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å§‹æ•è·æ•°æ®åŒ…</span></span><br><span class="line">    pcap_loop(handle, <span class="number">0</span>, packet_handler, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾è®¾å¤‡åˆ—è¡¨</span></span><br><span class="line">    pcap_freealldevs(alldevs);</span><br><span class="line"></span><br><span class="line">    pcap_close(handle);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œä»£ç æŠ“åŒ…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;--------- New Packet Arrived! ---------&gt;</span><br><span class="line">Total packet available: 90 bytes</span><br><span class="line">Expected packet size: 90 bytes</span><br><span class="line">IP header length (IHL) <span class="keyword">in</span> bytes: 20</span><br><span class="line">Source Address: 185.125.190.57</span><br><span class="line">Destination Address: 192.168.0.144</span><br><span class="line">Protocol: UDP</span><br><span class="line">UDP header length <span class="keyword">in</span> bytes: 8</span><br><span class="line">Size of all headers combined: 28 bytes</span><br><span class="line">Payload size: 48 bytes</span><br><span class="line">---------------------------------------</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæ‰¾åˆ°å¯ç”¨çš„ç½‘ç»œæ¥å£ï¼Œç¡®ä¿æŠ“åŒ…å·¥å…·ç›‘å¬åˆ°æŒ‡å®šç½‘ç»œæ¥å£ä¸Šçš„æ‰€æœ‰æ•°æ®åŒ…ï¼›æ‰“å¼€ç½‘ç»œæ¥å£ï¼Œç½®äºæ··æ‚æ¨¡å¼ï¼ˆ1ï¼‰ï¼Œä»¥ä¾¿æ•è·æ‰€æœ‰ç»è¿‡è¯¥æ¥å£çš„æ•°æ®åŒ…ï¼›å¾ªç¯æ•è·åŒ…ï¼Œè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œè§£æIPåŒ…å¤´çš„å­—æ®µï¼Œåˆ¤æ–­åŒ…æ‰€ä½¿ç”¨çš„ä¼ è¾“å±‚åè®®ç­‰ç­‰ã€‚</p>
<blockquote>
<p>libpcapé€šè¿‡æ“ä½œç³»ç»Ÿçš„ç½‘ç»œé©±åŠ¨ä»é“¾è·¯å±‚æ•è·æ•°æ®åŒ…ï¼Œå°†å…¶æš‚å­˜åœ¨å†…æ ¸ç¼“å†²åŒºä¸­ï¼Œç„¶åå°†æ•°æ®åŒ…ä¼ é€’åˆ°ç”¨æˆ·ç©ºé—´ä¾›åº”ç”¨ç¨‹åºåˆ†æã€‚</p>
</blockquote>
<p>å‚è€ƒå†…å®¹ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://docs.pingcode.com/baike/1020340">Cè¯­è¨€å¦‚ä½•åšæŠ“åŒ…</a></p>
<h2 id="ğŸ‘¿businçš„é‡å¿ƒ"><a href="#ğŸ‘¿businçš„é‡å¿ƒ" class="headerlink" title="ğŸ‘¿businçš„é‡å¿ƒ"></a>ğŸ‘¿businçš„é‡å¿ƒ</h2><p><strong>è¦æ±‚ï¼š</strong>è¯·ä½ å†™ä¸ªç¨‹åºï¼Œè‡ªåŠ¨æ£€æµ‹æ’è¡Œæ¦œçš„å˜åŒ–ã€‚å…·ä½“æœ‰å¦‚ä¸‹ä¸¤ä¸ªéœ€æ±‚ï¼š</p>
<ol>
<li>æ‹›æ–°ç½‘ç«™çš„æ’è¡Œæ¦œåŒ…å«10ä¸ªæ‹›æ–°ç›¸å…³æ–¹å‘ä»¥åŠä¸€ä¸ªæ€»åˆ†æ–¹å‘ã€‚å¦‚æœè¿™11ä¸ªç±»åˆ«ä¸­çš„ä»»æ„ä¸€ä¸ª<strong>æ’è¡Œçš„å‰åå</strong>å‘ç”Ÿäº†å˜åŒ–ï¼Œç¨‹åºå°±ä¼šæ‰“å°ï¼š1.æ–°çš„å‰ååæ’è¡Œ 2.å“ªä¸€ä¸ªäººæ‰å‡ºäº†å‰åå 3.å“ªä¸€ä¸ªäººè¿›å…¥äº†å‰ååã€‚</li>
<li>ç¨‹åºåº”è¯¥ç›‘æµ‹ç‰¹å®šçš„é¢˜ç›®ï¼ˆä½¿ç”¨åŠ¨æ€å®¹å™¨çš„é¢˜ç›®å¯ä»¥ä¸è¢«ç›‘æµ‹ï¼‰ã€‚å½“æœ‰äººé€šè¿‡äº†è¿™ä¸ªé¢˜ç›®åï¼Œç¨‹åºä¼šæŒ‰ç…§<code>f&quot;passer: &#123;user_name&#125;, task: &#123;task_name&#125;, time: &#123;passing_time&#125;&quot;</code>æ‰“å°å‡ºè¿™æ¡ä¿¡æ¯ã€‚</li>
</ol>
<p>å°†ç¨‹åºéƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šå®ç°24hè¿è¡Œï¼Œå¹¶èƒ½é€šè¿‡ç¤¾äº¤è½¯ä»¶&#x2F;é‚®ç®±&#x2F;å…¶ä»–èƒ½ä»ç§»åŠ¨è®¾å¤‡ä¸Šæ¥æ”¶åˆ°æ›´æ–°ä¿¡æ¯çš„æ–¹å¼ï¼Œå°†ä¿¡æ¯å‘é€åˆ°ä½ çš„ç§»åŠ¨è®¾å¤‡ä¸Šï¼Œå®ç°å¯è§†åŒ–çš„ç®¡ç†ç•Œé¢ã€‚ (ps:è¿™å¯èƒ½éœ€è¦ä¸€ç‚¹SAçš„çŸ¥è¯†ï¼‰</p>
<hr>
<p><strong>é¢˜è§£ï¼š</strong>é¦–å…ˆç¼–å†™ç¨‹åº<code>rank.py</code>å®ç°æ‰“å°æ’åå˜åŒ–æƒ…å†µã€‚</p>
<p>åœ¨<a target="_blank" rel="noopener" href="https://recruit.cnss.io/#/rank%E4%B8%8A%EF%BC%8C%E5%88%B7%E6%96%B0%E9%A1%B5%E9%9D%A2%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8E%A7%E5%88%B6%E5%8F%B0%E7%BD%91%E7%BB%9C%E4%B8%AD%E6%89%BE%E5%88%B0%E4%BA%86fullrank%EF%BC%8C%E5%85%B6%E9%80%9A%E8%BF%87XHR%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%AF%B4%E6%98%8E%E6%8E%92%E8%A1%8C%E6%A6%9C%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%83%BD%E6%98%AF%E9%80%9A%E8%BF%87%E8%AF%A5%E8%AF%B7%E6%B1%82%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E7%9A%84%E3%80%82%E4%BA%8E%E6%98%AF%E6%88%91%E4%BB%AC%E6%A8%A1%E6%8B%9F%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%8C**%E7%94%B1%E4%BA%8EToken%E5%9C%A8%E9%9A%8F%E7%9D%80%E6%97%B6%E9%97%B4%E5%8F%98%E5%8C%96%EF%BC%8C%E4%BA%8E%E6%98%AF%E6%B7%BB%E5%8A%A0%E6%89%8B%E5%8A%A8%E8%BE%93%E5%85%A5Token%E7%9A%84%E9%83%A8%E5%88%86%EF%BC%9A">https://recruit.cnss.io/#/rankä¸Šï¼Œåˆ·æ–°é¡µé¢åœ¨æµè§ˆå™¨æ§åˆ¶å°ç½‘ç»œä¸­æ‰¾åˆ°äº†fullrankï¼Œå…¶é€šè¿‡XHRè·å–æ•°æ®ï¼Œè¯´æ˜æ’è¡Œæ¦œçš„æ•°æ®å¯èƒ½æ˜¯é€šè¿‡è¯¥è¯·æ±‚åŠ¨æ€åŠ è½½çš„ã€‚äºæ˜¯æˆ‘ä»¬æ¨¡æ‹Ÿæµè§ˆå™¨çš„è¯·æ±‚ï¼Œ**ç”±äºTokenåœ¨éšç€æ—¶é—´å˜åŒ–ï¼Œäºæ˜¯æ·»åŠ æ‰‹åŠ¨è¾“å…¥Tokençš„éƒ¨åˆ†ï¼š</a>**</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fetch</span>(<span class="params">url, token</span>):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json, text/plain, */*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate, br, zstd&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9,en;q=0.8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;keep-alive&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;recruit.cnss.io:8443&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;https://recruit.cnss.io&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;https://recruit.cnss.io/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-CH-UA&quot;</span>: <span class="string">&#x27;&quot;Google Chrome&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;129&quot;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-CH-UA-Mobile&quot;</span>: <span class="string">&quot;?0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-CH-UA-Platform&quot;</span>: <span class="string">&#x27;&quot;Windows&quot;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-Fetch-Dest&quot;</span>: <span class="string">&quot;empty&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-Fetch-Mode&quot;</span>: <span class="string">&quot;cors&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-Fetch-Site&quot;</span>: <span class="string">&quot;same-site&quot;</span>,</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Token&quot;</span>: token</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url, headers=headers)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.json()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Failed to fetch rankings. HTTP Status Code: <span class="subst">&#123;response.status_code&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Response content: <span class="subst">&#123;response.text&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error fetching rankings: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸»å‡½æ•°æµç¨‹ï¼Œè®°å½•old_rankings.jsonæ–‡ä»¶ï¼Œfetchå¾—åˆ°new_rankingsï¼Œå¯¹æ–°æ—§æ’è¡Œè¿›è¡Œæ¯”è¾ƒï¼Œæ‰“å°ä¿¡æ¯ï¼Œæ›´æ–°old_rankingsã€‚</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line"></span><br><span class="line">    url = <span class="string">&quot;https://recruit.cnss.io:8443/v1/fullrank&quot;</span></span><br><span class="line">    token = <span class="built_in">input</span>(<span class="string">&quot;Please enter your access token: &quot;</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> token:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Your Token cannot be NULL.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;old_rankings.json&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            old_rankings = json.load(file)</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        old_rankings = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    new_rankings = fetch(url, token)</span><br><span class="line">    <span class="keyword">if</span> new_rankings:</span><br><span class="line">        changes = compare(old_rankings, new_rankings)</span><br><span class="line">        print_changes(changes)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;old_rankings.json&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            json.dump(new_rankings, file, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯compareå’Œprintå‡½æ•°</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">compare</span>(<span class="params">old_rankings, new_rankings</span>):</span><br><span class="line">    changes = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> direction, new_top10 <span class="keyword">in</span> new_rankings.items():</span><br><span class="line">        old_top10 = old_rankings.get(direction, [])</span><br><span class="line"></span><br><span class="line">        old_top10_users = [item[<span class="string">&#x27;Name&#x27;</span>] <span class="keyword">for</span> item <span class="keyword">in</span> old_top10[:<span class="number">10</span>] <span class="keyword">if</span> <span class="string">&#x27;Name&#x27;</span> <span class="keyword">in</span> item]</span><br><span class="line">        new_top10_users = [item[<span class="string">&#x27;Name&#x27;</span>] <span class="keyword">for</span> item <span class="keyword">in</span> new_top10[:<span class="number">10</span>] <span class="keyword">if</span> <span class="string">&#x27;Name&#x27;</span> <span class="keyword">in</span> item]</span><br><span class="line"></span><br><span class="line">        entered = <span class="built_in">set</span>(new_top10_users) - <span class="built_in">set</span>(old_top10_users)</span><br><span class="line">        dropped = <span class="built_in">set</span>(old_top10_users) - <span class="built_in">set</span>(new_top10_users)</span><br><span class="line"></span><br><span class="line">        order_changed = old_top10_users != new_top10_users <span class="comment">#judge</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> entered <span class="keyword">or</span> dropped <span class="keyword">or</span> order_changed:</span><br><span class="line">            changes[direction] = &#123;</span><br><span class="line">                <span class="string">&#x27;new_top10&#x27;</span>: [&#123;<span class="string">&#x27;Name&#x27;</span>: item[<span class="string">&#x27;Name&#x27;</span>], <span class="string">&#x27;Score&#x27;</span>: item[<span class="string">&#x27;Score&#x27;</span>]&#125; <span class="keyword">for</span> item <span class="keyword">in</span> new_top10[:<span class="number">10</span>] <span class="keyword">if</span> <span class="string">&#x27;Name&#x27;</span> <span class="keyword">in</span> item],</span><br><span class="line">                <span class="string">&#x27;entered&#x27;</span>: <span class="built_in">list</span>(entered),</span><br><span class="line">                <span class="string">&#x27;dropped&#x27;</span>: <span class="built_in">list</span>(dropped),</span><br><span class="line">                <span class="string">&#x27;order_changed&#x27;</span>: order_changed</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">return</span> changes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_changes</span>(<span class="params">changes</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> changes:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ’åæœªå‘ç”Ÿå˜åŒ–ã€‚&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> direction, details <span class="keyword">in</span> changes.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\næ–¹å‘: <span class="subst">&#123;direction&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ–°çš„å‰ååæ’è¡Œ:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> rank, user <span class="keyword">in</span> <span class="built_in">enumerate</span>(details[<span class="string">&#x27;new_top10&#x27;</span>], start=<span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  åæ¬¡ <span class="subst">&#123;rank&#125;</span>: <span class="subst">&#123;user[<span class="string">&#x27;Name&#x27;</span>]&#125;</span> (å¾—åˆ†: <span class="subst">&#123;user[<span class="string">&#x27;Score&#x27;</span>]&#125;</span>)&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> details[<span class="string">&#x27;entered&#x27;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;è¿›å…¥å‰ååçš„äºº: <span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(details[<span class="string">&#x27;entered&#x27;</span>])&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ²¡æœ‰æ–°è¿›å…¥å‰ååçš„äººã€‚&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> details[<span class="string">&#x27;dropped&#x27;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;æ‰å‡ºå‰ååçš„äºº: <span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(details[<span class="string">&#x27;dropped&#x27;</span>])&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ²¡æœ‰æ‰å‡ºå‰ååçš„äººã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> details[<span class="string">&#x27;order_changed&#x27;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;å‰ååå†…éƒ¨é¡ºåºå‘ç”Ÿäº†å˜åŒ–ã€‚&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œä¸€ä¸‹ï¼Œå¾—åˆ°è¾“å‡ºã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç¼–å†™<code>task.py</code>ç¨‹åºã€‚ä»¥ä¸€é“é¢˜ä¸ºä¾‹ï¼Œæˆ‘çš„æ€è·¯æ˜¯å…ˆåœ¨é¢˜ç›®<code>tasks</code>é‚£ä¸ªé¡µé¢ï¼Œæ•è·ç‰¹å®šé¢˜ç›®çš„<code>pass_number</code>ï¼Œå½“é€šè¿‡äººæ•°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéå†ç”¨æˆ·ï¼Œåœ¨<code>passrecord</code>å¯»æ‰¾è¯¥é¢˜çš„é€šè¿‡è€…ï¼Œ<strong>å¼‚æ­¥åŒ–</strong>ä»£ç å®ç°å¦‚ä¸‹</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Rocky006/article/details/134182815">Pythonå¼‚æ­¥ç½‘ç»œç¼–ç¨‹åˆ©å™¨â€”â€”è¯¦è§£aiohttpçš„ä½¿ç”¨æ•™ç¨‹</a></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">TASK_URL = <span class="string">&quot;https://recruit.cnss.io:8443/v1/tasks/534&quot;</span></span><br><span class="line">PASSRECORD_URL_TEMPLATE = <span class="string">&quot;https://recruit.cnss.io:8443/v1/passrecord/&#123;&#125;&quot;</span></span><br><span class="line">TARGET_TASK_TITLE = <span class="string">&quot;ğŸ‘¿businçš„é‡å¿ƒ&quot;</span></span><br><span class="line">USER_ID_RANGE = <span class="built_in">range</span>(<span class="number">530</span>, <span class="number">535</span>)</span><br><span class="line">SLEEP_INTERVAL = <span class="number">6</span></span><br><span class="line"></span><br><span class="line">previous_pass_number = <span class="literal">None</span></span><br><span class="line">user_submissions = &#123;&#125;</span><br><span class="line">token = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch_pass_number</span>(<span class="params">session</span>):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json, text/plain, */*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate, br, zstd&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9,en;q=0.8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;keep-alive&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;recruit.cnss.io:8443&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;https://recruit.cnss.io&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;https://recruit.cnss.io/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-CH-UA&quot;</span>: <span class="string">&#x27;&quot;Google Chrome&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;129&quot;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-CH-UA-Mobile&quot;</span>: <span class="string">&quot;?0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-CH-UA-Platform&quot;</span>: <span class="string">&#x27;&quot;Windows&quot;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-Fetch-Dest&quot;</span>: <span class="string">&quot;empty&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-Fetch-Mode&quot;</span>: <span class="string">&quot;cors&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-Fetch-Site&quot;</span>: <span class="string">&quot;same-site&quot;</span>,</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Token&quot;</span>: token</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> session.get(TASK_URL, headers=headers) <span class="keyword">as</span> response:</span><br><span class="line">            response.raise_for_status()</span><br><span class="line">            data = <span class="keyword">await</span> response.json()</span><br><span class="line"></span><br><span class="line">            tasks = data.get(<span class="string">&#x27;dev&#x27;</span>, [])</span><br><span class="line">            <span class="keyword">for</span> task <span class="keyword">in</span> tasks:</span><br><span class="line">                <span class="keyword">if</span> task.get(<span class="string">&#x27;title&#x27;</span>) == TARGET_TASK_TITLE:</span><br><span class="line">                    <span class="keyword">return</span> task.get(<span class="string">&#x27;pass_number&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> aiohttp.ClientError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è·å–ä»»åŠ¡æ•°æ®æ—¶å‘ç”Ÿå¼‚å¸¸: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å¤„ç†ä»»åŠ¡æ•°æ®æ—¶å‘ç”Ÿå¼‚å¸¸: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch_user_submission</span>(<span class="params">session, user_id</span>):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json, text/plain, */*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate, br, zstd&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9,en;q=0.8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;keep-alive&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;recruit.cnss.io:8443&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;https://recruit.cnss.io&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;https://recruit.cnss.io/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-CH-UA&quot;</span>: <span class="string">&#x27;&quot;Google Chrome&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;129&quot;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-CH-UA-Mobile&quot;</span>: <span class="string">&quot;?0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-CH-UA-Platform&quot;</span>: <span class="string">&#x27;&quot;Windows&quot;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-Fetch-Dest&quot;</span>: <span class="string">&quot;empty&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-Fetch-Mode&quot;</span>: <span class="string">&quot;cors&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Sec-Fetch-Site&quot;</span>: <span class="string">&quot;same-site&quot;</span>,</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Token&quot;</span>: token</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    url = PASSRECORD_URL_TEMPLATE.<span class="built_in">format</span>(user_id)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> session.get(url, headers=headers) <span class="keyword">as</span> response:</span><br><span class="line">            response.raise_for_status()</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> response.json()</span><br><span class="line">    <span class="keyword">except</span> aiohttp.ClientError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è·å–ç”¨æˆ· <span class="subst">&#123;user_id&#125;</span> çš„æ•°æ®æ—¶å‡ºé”™: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å¤„ç†ç”¨æˆ· <span class="subst">&#123;user_id&#125;</span> çš„æ•°æ®æ—¶å‡ºé”™: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ•´ä¸ªå‡½æ•°çš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼šé€šè¿‡fetchåˆå§‹åŒ–æ¯ä¸ªç”¨æˆ·ï¼ˆè¿™é‡Œæ˜¯530åˆ°535ï¼‰çš„æäº¤å†…å®¹ï¼Œè®°å½•ä¸‹æ¥ï¼Œç„¶åæ¯6ç§’å»ç›‘æµ‹ç‰¹å®šé¢˜ç›®çš„é€šè¿‡äººæ•°æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œè°ƒç”¨checkå‡½æ•°éå†æ¯”å¯¹ï¼Œæ‰“å°å‡ºä¿¡æ¯ã€‚</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">global</span> token</span><br><span class="line">    token = <span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥Token: &quot;</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> token:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Tokenä¸èƒ½ä¸ºç©ºã€‚&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    user_ids = USER_ID_RANGE</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">await</span> initialize_user_records(session, user_ids)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">await</span> monitor_pass_number(session, user_ids)</span><br><span class="line">            <span class="keyword">await</span> asyncio.sleep(SLEEP_INTERVAL)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        asyncio.run(main())</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nç¨‹åºå·²æ‰‹åŠ¨ç»ˆæ­¢ã€‚&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æˆ‘ä»¬å®Œå–„éå†ç”¨æˆ·ï¼Œè¿›è¡Œåˆå§‹åŒ–ç”¨æˆ·çš„æäº¤å†…å®¹ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">initialize_user_records</span>(<span class="params">session, user_ids</span>):</span><br><span class="line">    <span class="keyword">global</span> user_submissions</span><br><span class="line">    tasks = [fetch_user_submission(session, user_id) <span class="keyword">for</span> user_id <span class="keyword">in</span> user_ids]</span><br><span class="line">    submissions = <span class="keyword">await</span> asyncio.gather(*tasks)</span><br><span class="line">    <span class="keyword">for</span> user_id, submission <span class="keyword">in</span> <span class="built_in">zip</span>(user_ids, submissions):</span><br><span class="line">        <span class="keyword">if</span> submission <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            user_submissions[user_id] = submission</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;åˆå§‹è®°å½•å·²ä¿å­˜ç”¨æˆ· <span class="subst">&#123;user_id&#125;</span>ã€‚&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;æœªèƒ½è·å–ç”¨æˆ· <span class="subst">&#123;user_id&#125;</span> çš„åˆå§‹è®°å½•ã€‚&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ç›‘æµ‹ç‰¹å®šé¢˜ç›®äººæ•°å¹¶åœ¨å˜åŒ–æ—¶éå†ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">monitor_pass_number</span>(<span class="params">session, user_ids</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">global</span> previous_pass_number</span><br><span class="line">    current_pass_number = <span class="keyword">await</span> fetch_pass_number(session)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> current_pass_number <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">if</span> previous_pass_number <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            previous_pass_number = current_pass_number</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;åˆå§‹ pass_number: <span class="subst">&#123;current_pass_number&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> current_pass_number &gt; previous_pass_number:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;pass_number å¢åŠ äº†ï¼æ–°çš„ pass_number: <span class="subst">&#123;current_pass_number&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">await</span> check_user_submission_changes(session, user_ids)</span><br><span class="line">            previous_pass_number = current_pass_number</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;å½“å‰ pass_number: <span class="subst">&#123;current_pass_number&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ— æ³•è·å– pass_number&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">check_user_submission_changes</span>(<span class="params">session, user_ids</span>):</span><br><span class="line">    <span class="keyword">global</span> user_submissions</span><br><span class="line"></span><br><span class="line">    tasks = [fetch_user_submission(session, user_id) <span class="keyword">for</span> user_id <span class="keyword">in</span> user_ids]</span><br><span class="line">    submissions = <span class="keyword">await</span> asyncio.gather(*tasks)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> user_id, new_submission <span class="keyword">in</span> <span class="built_in">zip</span>(user_ids, submissions):</span><br><span class="line">        <span class="keyword">if</span> new_submission <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        previous_submission = user_submissions.get(user_id, [])</span><br><span class="line">        new_tasks = &#123;task[<span class="string">&#x27;TaskID&#x27;</span>]: task <span class="keyword">for</span> task <span class="keyword">in</span> new_submission&#125;</span><br><span class="line">        old_tasks = &#123;task[<span class="string">&#x27;TaskID&#x27;</span>]: task <span class="keyword">for</span> task <span class="keyword">in</span> previous_submission&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> task_id, new_task <span class="keyword">in</span> new_tasks.items():</span><br><span class="line">            old_task = old_tasks.get(task_id)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> old_task <span class="keyword">or</span> old_task.get(<span class="string">&#x27;Score&#x27;</span>) != new_task.get(<span class="string">&#x27;Score&#x27;</span>):</span><br><span class="line">                <span class="keyword">if</span> new_task.get(<span class="string">&#x27;TaskTitle&#x27;</span>) == TARGET_TASK_TITLE:</span><br><span class="line">                    user_name = <span class="string">f&quot;User <span class="subst">&#123;user_id&#125;</span>&quot;</span></span><br><span class="line">                    task_name = new_task.get(<span class="string">&#x27;TaskTitle&#x27;</span>)</span><br><span class="line">                    passing_time = datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;passer: <span class="subst">&#123;user_name&#125;</span>, task: <span class="subst">&#123;task_name&#125;</span>, time: <span class="subst">&#123;passing_time&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        user_submissions[user_id] = new_submission    </span><br></pre></td></tr></table></figure>

<p>è¿è¡Œä¸Šè¿°ä»£ç ï¼Œå¾—åˆ°è¾“å‡ºç»“æœã€‚é€Ÿåº¦æœ‰æ˜æ˜¾æå‡ã€‚</p>
<h2 id="ğŸ¤–GPT2"><a href="#ğŸ¤–GPT2" class="headerlink" title="ğŸ¤–GPT2"></a>ğŸ¤–GPT2</h2><p><strong>ç›®æ ‡ï¼š</strong>ä½ å¯èƒ½å·²ç»å‘ç°äº†ï¼Œä½ çš„ç¨‹åºå¯èƒ½å¹¶æ²¡æœ‰æˆ‘æ¼”ç¤ºçš„è·‘çš„é‚£ä¹ˆå¿«ï¼ˆ<del>ç¥æœºè¯·å¿½ç•¥</del>ï¼‰ã€‚</p>
<p>ä½ çš„ç›®æ ‡å°±æ˜¯ä¼˜åŒ–è¯¥ç¨‹åºçš„æ€§èƒ½ï¼Œåœ¨ä¿è¯ç»“æœä¸å˜çš„æƒ…å†µä¸‹æ›´å¿«çš„å®Œæˆæ–‡æœ¬çš„è¡¥å…¨ã€‚</p>
<p>æˆ‘ä¼šä½¿ç”¨ä¸€äº›æµ‹è¯•ç‚¹æ¥è¯„æµ‹ä½ çš„ç¨‹åºçš„æ­£ç¡®æ€§å’Œæ‰§è¡Œæ—¶é—´ã€‚æœŸå¾…æ›´é«˜çš„æ•ˆç‡å’Œæ›´å¤šæ ·çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚</p>
<p>æ­¤å¤–ï¼Œè¯·åœ¨ wp ä¸­å›ç­”ä¸‹é¢çš„é—®é¢˜ï¼š</p>
<ul>
<li>ä»€ä¹ˆæ˜¯é˜¿å§†è¾¾å°”å®šå¾‹ï¼Ÿæ ¹æ®é˜¿å§†è¾¾å°”å®šå¾‹ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠä¼˜åŒ–çš„é‡ç‚¹æ”¾åœ¨å“ªé‡Œï¼Ÿ</li>
<li>ä½ çš„ä¼˜åŒ–æ–¹æ¡ˆå’Œæ€è·¯æ˜¯ä»€ä¹ˆï¼Ÿä¼˜åŒ–çš„æ•ˆæœå—åˆ°å“ªäº›å› ç´ å½±å“ï¼Ÿ</li>
</ul>
<hr>
<p><strong>é¢˜è§£ï¼š</strong>æŒ‰ç…§æŒ‡ç¤ºå®ŒæˆGPT2ï¼Œmakeè¿è¡Œä¸€ä¸‹ï¼Œå‘ç°éœ€è¦20å¤šç§’ã€‚</p>
<p>é˜¿å§†è¾¾å°”å®šå¾‹æ˜¯ä¸€ä¸ªç»éªŒæ³•åˆ™ï¼Œä»£è¡¨å¤„ç†å™¨å¹¶è¡Œè¿ç®—ä¹‹åæ•ˆç‡æå‡çš„èƒ½åŠ›ã€‚åœ¨å¹¶è¡Œè®¡ç®—ä¸­ï¼Œä½¿ç”¨å¤šä¸ªå¤„ç†å™¨çš„ç¨‹åºçš„åŠ é€Ÿæ¯”å—é™åˆ¶äºç¨‹åº<em><strong>ä¸²è¡Œéƒ¨åˆ†</strong></em>çš„æ‰§è¡Œæ—¶é—´ã€‚<br>$$<br>s(n)&#x3D;\frac{1}{B+(1-B)&#x2F;n}<br>$$</p>
<ul>
<li>$s(n):$ å›ºå®šè´Ÿè½½ä¸‹ï¼Œç†è®ºä¸Šçš„åŠ é€Ÿæ¯”</li>
<li>$B:$ ä¸²è¡Œå·¥ä½œéƒ¨åˆ†æ‰€å æ¯”ä¾‹ï¼Œå–å€¼0~1</li>
<li>$n:$ å¹¶è¡Œçº¿ç¨‹æ•°ï¼Œå¹¶è¡Œå¤„ç†èŠ‚ç‚¹ä¸ªæ•°</li>
</ul>
<p>å¯ä»¥çœ‹å‡ºï¼Œå³ä½¿æˆ‘ä»¬å¢åŠ å¤„ç†å™¨æ•°é‡ï¼Œåªèƒ½å¯¹å¹¶è¡Œéƒ¨åˆ†äº§ç”Ÿå½±å“ï¼Œè€Œå¯¹éå¹¶è¡Œéƒ¨åˆ†æ²¡æœ‰ä»»ä½•å½±å“ã€‚å› æ­¤éšç€å¤„ç†å™¨æ•°é‡å¢åŠ ï¼Œæ•´ä½“æ€§èƒ½çš„æå‡ä¼šè¶‹äºå¹³ç¼“ã€‚</p>
<p>æ ¹æ®é˜¿å§†è¾¾å°”å®šå¾‹ï¼Œåº”è¯¥å°†ä¼˜åŒ–é‡ç‚¹æ”¾åœ¨<strong>æœ€å°åŒ–ä¸²è¡Œéƒ¨åˆ†ï¼ŒåŒæ—¶æœ€å¤§åŒ–å¯å¹¶è¡Œéƒ¨åˆ†</strong>ã€‚</p>
<p>æµè§ˆæº<code>gpt.c</code>ä»£ç ä¸­æ³¨æ„åˆ°ï¼Œå­˜åœ¨çŸ©é˜µä¹˜æ³•ã€æ³¨æ„åŠ›æœºåˆ¶å’Œæ¶‰åŠå¤§é‡è®¡ç®—çš„å¾ªç¯ï¼Œå¯ä»¥è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œå°†ä»»åŠ¡åˆ†é…åˆ°å¤šä¸ªå¤„ç†å™¨ä¸Šï¼Œä½¿ç”¨OpenMPå¹¶è¡ŒåŒ–çŸ©é˜µä¹˜æ³•ã€å‰é¦ˆç¥ç»ç½‘ç»œå±‚ç­‰ã€‚</p>
<p>å…·ä½“æ“ä½œæ˜¯åœ¨<code>matmul_forward</code>å’Œ<code>attention_forward</code>å‡½æ•°å¾ªç¯å‰æ·»åŠ ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;omp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> omp parallel for collapse(2)</span></span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ï¼Œåœ¨MakeFileä¸­å¼€å¯ç¼–è¯‘é€‰é¡¹<code>-fopenmp</code>ã€‚</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">release:</span></span><br><span class="line">	cc gpt.c -lm -O3 -fopenmp -Wno-unused-result -Wno-unused-value -Wno-unused-variable -o gpt</span><br><span class="line"></span><br><span class="line"><span class="section">debug:</span></span><br><span class="line">	cc gpt.c -lm -O1 -g -fopenmp -Wno-unused-result -Wno-unused-value -Wno-unused-variable -o gpt</span><br></pre></td></tr></table></figure>

<p>å‰åå¯¹æ¯”ä¸€ä¸‹</p>
<p>åœ¨ä¿è¯ç»“æœä¸å˜çš„æƒ…å†µä¸‹æ›´å¿«çš„ï¼ˆ5~6ç§’)å®Œæˆäº†æ–‡æœ¬çš„è¡¥å…¨ã€‚</p>
<p>ä¼˜åŒ–æ•ˆæœå—å½±å“çš„å› ç´ ï¼š</p>
<ul>
<li>ä¸²è¡Œéƒ¨åˆ†ï¼šæ€»åŠ é€Ÿæ¯”ä¼šå—åˆ°åˆ¶çº¦</li>
<li>ç¡¬ä»¶èµ„æºï¼šå¯ç”¨å¤„ç†å™¨çš„æ•°é‡å’Œç¡¬ä»¶çš„æ€§èƒ½</li>
<li>ç¼–è¯‘å™¨çš„ä¼˜åŒ–ç¨‹åº¦</li>
<li>å¹¶è¡ŒåŒ–çš„å¼€é”€ã€‚</li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>CNSS Recruit 2024 Dev wp</p><p><a href="http://aununo.xyz/2024/09/30/CNSS Recruit 2024 Dev wp/">http://aununo.xyz/2024/09/30/CNSS Recruit 2024 Dev wp/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Aununo Gan</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2024-09-30</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-07-14</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i> </a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i> </a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i> </a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i>Â <a class="link-muted" rel="tag" href="/tags/Dev/">Dev,Â </a><a class="link-muted" rel="tag" href="/tags/CNSS/">CNSS </a></div></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/" alt="Alipay"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="https://pic1.imgdb.cn/item/6810a12858cb8da5c8d45496.png" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2024/08/07/CNSS-Summer-Camp-2024%20wp/"><span class="level-item">CNSS Summer-Camp 2024 wp</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level" style="margin-bottom:1rem"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="Aununo"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Aununo</p><p class="is-size-6 is-block">Identity follows your actions.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Chengdu, China</span></p></div></div></nav><nav class="level menu-list is-mobile" style="margin-bottom:1rem"><a class="level-item has-text-centered is-marginless" href="/archives/"><div><p class="heading">Posts</p><div><p class="title">4</p></div></div></a><a class="level-item has-text-centered is-marginless" href="/categories/"><div><p class="heading">Categories</p><div><p class="title">3</p></div></div></a><a class="level-item has-text-centered is-marginless" href="/tags/"><div><p class="heading">Tags</p><div><p class="title">9</p></div></div></a></nav><div class="level"><a class="level-item button is-primary is-rounded" href="mailto:ganrunzhuo@gmail.com" target="_blank" rel="noopener"><i class="fas fa-envelope"></i>Â Â Email Me</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/Aununo"><i class="fab fa-github"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#ğŸ¥³MANï¼"><span class="level-left"><span class="level-item">1</span><span class="level-item">ğŸ¥³MANï¼</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#CH1"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">CH1</span></span></a></li><li><a class="level is-mobile" href="#CH2"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">CH2</span></span></a></li><li><a class="level is-mobile" href="#CH3"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">CH3</span></span></a></li></ul></li><li><a class="level is-mobile" href="#ğŸ˜¶â€ğŸŒ«ï¸Oop-Loop"><span class="level-left"><span class="level-item">2</span><span class="level-item">ğŸ˜¶â€ğŸŒ«ï¸Oop Loop</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#CH1-1"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">CH1</span></span></a></li><li><a class="level is-mobile" href="#CH2-1"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">CH2</span></span></a></li></ul></li><li><a class="level is-mobile" href="#â™¿é€ è½®å­"><span class="level-left"><span class="level-item">3</span><span class="level-item">â™¿é€ è½®å­</span></span></a></li><li><a class="level is-mobile" href="#âš’ï¸Dig-and-Dig"><span class="level-left"><span class="level-item">4</span><span class="level-item">âš’ï¸Dig and Dig</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#CH1-2"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">CH1</span></span></a></li><li><a class="level is-mobile" href="#CH2-2"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">CH2</span></span></a></li></ul></li><li><a class="level is-mobile" href="#ğŸ§®Primes"><span class="level-left"><span class="level-item">5</span><span class="level-item">ğŸ§®Primes</span></span></a></li><li><a class="level is-mobile" href="#â­æ•°æ•°"><span class="level-left"><span class="level-item">6</span><span class="level-item">â­æ•°æ•°</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#CH1-3"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">CH1</span></span></a></li><li><a class="level is-mobile" href="#CH2-3"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">CH2</span></span></a></li></ul></li><li><a class="level is-mobile" href="#ğŸ“ŸBitter"><span class="level-left"><span class="level-item">7</span><span class="level-item">ğŸ“ŸBitter</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#CH1-4"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">CH1</span></span></a></li><li><a class="level is-mobile" href="#CH2-4"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">CH2</span></span></a></li></ul></li><li><a class="level is-mobile" href="#ğŸ©é¡ºæ‰‹ç‰µç¾Š"><span class="level-left"><span class="level-item">8</span><span class="level-item">ğŸ©é¡ºæ‰‹ç‰µç¾Š</span></span></a></li><li><a class="level is-mobile" href="#ğŸ‘¿businçš„é‡å¿ƒ"><span class="level-left"><span class="level-item">9</span><span class="level-item">ğŸ‘¿businçš„é‡å¿ƒ</span></span></a></li><li><a class="level is-mobile" href="#ğŸ¤–GPT2"><span class="level-left"><span class="level-item">10</span><span class="level-item">ğŸ¤–GPT2</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Aununo&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2025 Aununo Gan</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">Â© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>